<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>Dashboard PMS - Lawmar Les R√©sidences - Gandiol üá∏üá≥</title>
    
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome 6 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <!-- jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- html2canvas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- FullCalendar -->
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
    <!-- DataTables -->
    <link href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap5.min.css" rel="stylesheet">
    <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"></script>
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <style>
        /* ===== VARIABLES ===== */
        :root {
            --primary: #025ba5;
            --primary-dark: #024a84;
            --primary-light: #e6f0fa;
            --secondary: #d4af37;
            --secondary-dark: #b38f2c;
            --secondary-light: #faf3e0;
            --accent: #c53030;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --info: #17a2b8;
            --dark: #1e293b;
            --light: #f8fafc;
            --gray-100: #f1f5f9;
            --gray-200: #e2e8f0;
            --gray-300: #cbd5e1;
            --gray-400: #94a3b8;
            --gray-500: #64748b;
            --sidebar-width: 280px;
            --card-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05), 0 8px 10px -6px rgba(0, 0, 0, 0.02);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f1f5f9 0%, #e6f0fa 100%);
            color: var(--dark);
            min-height: 100vh;
        }

        /* ===== SCROLLBAR ===== */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track { background: var(--gray-100); border-radius: 10px; }
        ::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--primary-dark); }

        /* ===== LOGO ===== */
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .logo-img {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            object-fit: cover;
            border: 3px solid var(--secondary);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .logo-text h1 {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--primary);
            margin: 0;
            line-height: 1.2;
        }
        .logo-text p {
            font-size: 0.7rem;
            color: var(--gray-500);
            margin: 0;
        }

        /* ===== LOADING OVERLAY ===== */
        #loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255,255,255,0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            backdrop-filter: blur(5px);
            transition: opacity 0.5s;
        }
        .loader {
            width: 60px;
            height: 60px;
            border: 5px solid var(--gray-200);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s infinite linear;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* ===== LAYOUT ===== */
        .dashboard { display: flex; min-height: 100vh; }
        
        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background: white;
            box-shadow: 4px 0 20px rgba(0, 0, 0, 0.02);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            transition: var(--transition);
            z-index: 100;
        }
        .sidebar-header { padding: 25px 20px; border-bottom: 1px solid var(--gray-200); }
        .sidebar-menu { padding: 20px 0; }
        .menu-section { margin-bottom: 25px; }
        .menu-section-title {
            padding: 0 20px;
            margin-bottom: 10px;
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--gray-400);
            font-weight: 600;
        }
        .menu-item {
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--gray-500);
            transition: var(--transition);
            cursor: pointer;
            margin: 4px 10px;
            border-radius: 12px;
        }
        .menu-item i { width: 24px; font-size: 1.2rem; color: var(--primary); }
        .menu-item:hover { background: var(--primary-light); color: var(--primary); }
        .menu-item.active { background: var(--primary); color: white; }
        .menu-item.active i { color: white; }
        .menu-item .badge {
            margin-left: auto;
            background: var(--secondary);
            color: var(--primary);
            font-weight: 600;
            font-size: 0.65rem;
            padding: 4px 8px;
        }

        /* Main Content */
        .main {
            flex: 1;
            margin-left: var(--sidebar-width);
            padding: 20px 30px;
            transition: var(--transition);
        }

        /* Top Bar */
        .top-bar {
            background: white;
            border-radius: 20px;
            padding: 15px 25px;
            margin-bottom: 25px;
            box-shadow: var(--card-shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        .page-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary);
            margin: 0;
        }
        .date-display {
            background: var(--primary-light);
            padding: 8px 18px;
            border-radius: 40px;
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--primary);
        }
        .date-display i { margin-right: 8px; color: var(--secondary); }
        .user-profile { display: flex; align-items: center; gap: 20px; }
        .user-role {
            background: var(--secondary-light);
            padding: 8px 18px;
            border-radius: 40px;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--secondary-dark);
        }
        .user-role i { margin-right: 8px; color: var(--secondary); }
        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 12px;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }
        .user-avatar:hover {
            background: var(--danger);
            transform: scale(1.05);
        }

        /* Role Tabs */
        .role-tabs-modern {
            background: white;
            border-radius: 60px;
            padding: 6px;
            display: inline-flex;
            box-shadow: var(--card-shadow);
            margin-bottom: 25px;
        }
        .role-tab-modern {
            padding: 12px 30px;
            border-radius: 60px;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: var(--transition);
            color: var(--gray-500);
        }
        .role-tab-modern i { margin-right: 8px; }
        .role-tab-modern:hover { color: var(--primary); }
        .role-tab-modern.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 10px rgba(2, 91, 165, 0.2);
        }

        /* Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        .stat-card-modern {
            background: white;
            border-radius: 20px;
            padding: 22px;
            box-shadow: var(--card-shadow);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }
        .stat-card-modern::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }
        .stat-card-modern:hover { transform: translateY(-5px); }
        .stat-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px; }
        .stat-icon-modern {
            width: 55px;
            height: 55px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
        }
        .stat-icon-modern.primary { background: linear-gradient(135deg, rgba(2, 91, 165, 0.1), rgba(2, 91, 165, 0.2)); color: var(--primary); }
        .stat-icon-modern.success { background: linear-gradient(135deg, rgba(40, 167, 69, 0.1), rgba(40, 167, 69, 0.2)); color: var(--success); }
        .stat-icon-modern.warning { background: linear-gradient(135deg, rgba(255, 193, 7, 0.1), rgba(255, 193, 7, 0.2)); color: var(--warning); }
        .stat-icon-modern.danger { background: linear-gradient(135deg, rgba(220, 53, 69, 0.1), rgba(220, 53, 69, 0.2)); color: var(--danger); }
        .stat-value-modern { font-size: 2.2rem; font-weight: 700; color: var(--dark); line-height: 1.2; }
        .stat-label-modern { color: var(--gray-500); font-size: 0.9rem; font-weight: 500; }
        .stat-trend { display: flex; align-items: center; gap: 5px; font-size: 0.8rem; margin-top: 10px; }
        .trend-up { color: var(--success); }
        .trend-down { color: var(--danger); }

        /* Charts */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        .chart-card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: var(--card-shadow);
        }
        .chart-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .chart-header h3 { font-size: 1.1rem; font-weight: 600; color: var(--dark); margin: 0; }
        .chart-header i { color: var(--primary); font-size: 1.2rem; }

        /* Tables */
        .table-card {
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: var(--card-shadow);
            margin-bottom: 25px;
        }
        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }
        .table-header h3 {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--dark);
            margin: 0;
        }
        .table-header h3 i { color: var(--secondary); margin-right: 10px; }

        /* Buttons */
        .btn-modern {
            padding: 8px 18px;
            border-radius: 40px;
            font-weight: 500;
            font-size: 0.85rem;
            border: none;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .btn-modern.primary { background: var(--primary); color: white; }
        .btn-modern.primary:hover { background: var(--primary-dark); transform: translateY(-2px); box-shadow: 0 8px 15px rgba(2, 91, 165, 0.2); }
        .btn-modern.secondary { background: var(--secondary); color: var(--primary); }
        .btn-modern.success { background: var(--success); color: white; }
        .btn-modern.warning { background: var(--warning); color: var(--dark); }
        .btn-modern.danger { background: var(--danger); color: white; }
        .btn-modern.outline { background: transparent; border: 2px solid var(--primary); color: var(--primary); }
        
        .btn-icon {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: var(--gray-100);
            color: var(--primary);
            transition: var(--transition);
            border: none;
            margin: 0 2px;
        }
        .btn-icon:hover { background: var(--primary); color: white; transform: translateY(-2px); }
        .btn-icon.danger:hover { background: var(--danger); }

        /* Badges */
        .badge-modern {
            padding: 5px 12px;
            border-radius: 40px;
            font-size: 0.7rem;
            font-weight: 600;
            display: inline-block;
        }
        .badge-success { background: rgba(40, 167, 69, 0.15); color: var(--success); }
        .badge-warning { background: rgba(255, 193, 7, 0.15); color: #b76e00; }
        .badge-danger { background: rgba(220, 53, 69, 0.15); color: var(--danger); }
        .badge-info { background: rgba(2, 91, 165, 0.15); color: var(--primary); }

        /* Kitchen Orders */
        .kitchen-orders {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        .kitchen-card {
            background: var(--gray-100);
            border-radius: 16px;
            padding: 15px;
            border-left: 4px solid var(--warning);
        }
        .kitchen-header { display: flex; justify-content: space-between; margin-bottom: 10px; }
        .table-number { font-weight: 700; color: var(--primary); }
        .timer { font-size: 0.75rem; color: var(--gray-500); }
        .kitchen-items { list-style: none; padding: 0; margin: 10px 0; }
        .kitchen-items li { font-size: 0.8rem; padding: 3px 0; border-bottom: 1px dashed var(--gray-300); }

        /* Notifications */
        .notification-center {
            position: fixed;
            top: 100px;
            right: 30px;
            z-index: 9999;
            max-width: 350px;
        }
        .notification-item {
            background: white;
            border-radius: 12px;
            padding: 15px 20px;
            margin-bottom: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border-left: 5px solid;
            animation: slideInRight 0.3s ease;
        }
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Modal */
        .modal-content-modern {
            border-radius: 24px;
            border: none;
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);
        }
        .modal-header-modern {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border-radius: 24px 24px 0 0;
            padding: 20px 30px;
        }
        .modal-body-modern { padding: 30px; }
        .form-label { font-weight: 600; color: var(--dark); margin-bottom: 8px; }
        .form-control-modern {
            border: 2px solid var(--gray-200);
            border-radius: 12px;
            padding: 12px 15px;
            transition: var(--transition);
        }
        .form-control-modern:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(2, 91, 165, 0.1);
            outline: none;
        }

        /* Room Cards */
        .room-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
        .room-card {
            background: white;
            border-radius: 16px;
            padding: 15px;
            border-left: 4px solid;
            cursor: pointer;
            transition: var(--transition);
        }
        .room-card.available { border-left-color: var(--success); }
        .room-card.occupied { border-left-color: var(--primary); }
        .room-card.reserved { border-left-color: var(--warning); }
        .room-card.maintenance { border-left-color: var(--danger); }
        .room-card:hover { transform: translateY(-3px); box-shadow: var(--card-shadow); }
        .room-number { font-size: 1.2rem; font-weight: 700; color: var(--dark); }
        .room-type { font-size: 0.8rem; color: var(--gray-500); }
        .room-price { font-weight: 600; color: var(--primary); }

        /* Invoice Preview */
        .invoice-preview {
            background: white;
            border-radius: 16px;
            padding: 25px;
            max-width: 800px;
            margin: 0 auto;
        }
        .invoice-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 20px;
            border-bottom: 2px dashed var(--gray-300);
            margin-bottom: 20px;
        }
        .invoice-logo { width: 80px; height: 80px; object-fit: cover; border-radius: 12px; }
        .invoice-title { font-size: 2rem; font-weight: 800; color: var(--primary); }
        .invoice-details { margin-bottom: 20px; }
        .invoice-table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        .invoice-table th { background: var(--primary-light); color: var(--primary); padding: 10px; text-align: left; }
        .invoice-table td { padding: 10px; border-bottom: 1px solid var(--gray-200); }
        .invoice-total { text-align: right; font-size: 1.3rem; font-weight: 700; color: var(--primary); }

        /* Responsive */
        @media (max-width: 1024px) {
            .sidebar { transform: translateX(-100%); }
            .sidebar.show { transform: translateX(0); }
            .main { margin-left: 0; }
        }
        @media (max-width: 768px) {
            .main { padding: 15px; }
            .stats-grid { grid-template-columns: 1fr; }
            .charts-grid { grid-template-columns: 1fr; }
            .role-tabs-modern { flex-wrap: wrap; border-radius: 20px; }
            .role-tab-modern { width: 100%; text-align: center; }
            .room-grid { grid-template-columns: repeat(2, 1fr); }
        }
        @media (max-width: 480px) {
            .room-grid { grid-template-columns: 1fr; }
        }

        /* Calendar */
        .fc-event { background: var(--primary) !important; border: none !important; padding: 4px !important; font-size: 0.8rem !important; }
        .fc-day-today { background: var(--primary-light) !important; }

        /* Login Page */
        .login-page {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            padding: 20px;
        }
        
        .login-container {
            max-width: 450px;
            width: 100%;
            background: white;
            border-radius: 30px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .login-header img {
            width: 100px;
            height: 100px;
            border-radius: 25px;
            margin-bottom: 20px;
            border: 4px solid var(--secondary);
        }
        
        .login-header h2 {
            color: var(--primary);
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .login-header p {
            color: var(--gray-500);
        }
        
        .login-form .form-group {
            margin-bottom: 20px;
        }
        
        .login-form label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }
        
        .login-form .input-group {
            position: relative;
        }
        
        .login-form .input-group i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary);
            z-index: 10;
        }
        
        .login-form .form-control {
            width: 100%;
            padding: 15px 15px 15px 45px;
            border: 2px solid var(--gray-200);
            border-radius: 15px;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .login-form .form-control:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 4px rgba(2, 91, 165, 0.1);
        }
        
        .login-btn {
            width: 100%;
            padding: 15px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }
        
        .login-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(2, 91, 165, 0.3);
        }
        
        .login-btn:active {
            transform: translateY(0);
        }
        
        .alert {
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: none;
        }
        
        .alert-danger {
            background: #fee;
            color: #c33;
            border: 1px solid #fcc;
        }
        
        .alert-success {
            background: #efe;
            color: #3c3;
            border: 1px solid #cfc;
        }
        
        .demo-credentials {
            margin-top: 30px;
            padding: 20px;
            background: var(--gray-100);
            border-radius: 15px;
            font-size: 0.95rem;
        }
        
        .demo-credentials p {
            margin: 8px 0;
            color: var(--gray-600);
        }
        
        .demo-credentials strong {
            color: var(--primary);
        }
        
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }
        
        /* Dashboard cach√© par d√©faut */
        #dashboard {
            display: none;
        }
    </style>
</head>
<body>
    <!-- Page de connexion -->
    <div id="loginPage" class="login-page">
        <div class="login-container">
            <div class="login-header">
                <img src="images/logo1.png" alt="Lawmar Logo" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'100\' height=\'100\' viewBox=\'0 0 100 100\'%3E%3Crect width=\'100\' height=\'100\' fill=\'%23025ba5\'/%3E%3Ctext x=\'50\' y=\'68\' font-size=\'50\' text-anchor=\'middle\' fill=\'%23ffffff\' font-family=\'Arial\'%3ELAW%3C/text%3E%3C/svg%3E'">
                <h2>Lawmar PMS</h2>
                <p>Les R√©sidences du Lawmar - Gandiol üá∏üá≥</p>
            </div>
            
            <div id="loginAlert" class="alert alert-danger">
                <i class="fas fa-exclamation-circle me-2"></i>
                <span id="alertMessage"></span>
            </div>
            
            <form class="login-form" id="loginForm">
                <div class="form-group">
                    <label><i class="fas fa-user me-2"></i>Nom d'utilisateur</label>
                    <div class="input-group">
                        <i class="fas fa-user"></i>
                        <input type="text" class="form-control" id="username" placeholder="admin / reception / restaurant" required autofocus>
                    </div>
                </div>
                
                <div class="form-group">
                    <label><i class="fas fa-lock me-2"></i>Mot de passe</label>
                    <div class="input-group">
                        <i class="fas fa-lock"></i>
                        <input type="password" class="form-control" id="password" placeholder="lawmar2024!" required>
                    </div>
                </div>
                
                <button type="submit" class="login-btn" id="loginBtn">
                    <span class="login-btn-text">Se connecter</span>
                </button>
            </form>
            
            <div class="demo-credentials">
                <p><i class="fas fa-info-circle me-2" style="color: var(--primary);"></i><strong>Acc√®s s√©curis√© :</strong></p>
                <p>üëë <strong>admin</strong> / <strong>lawmar2024!</strong> (Manager)</p>
                <p>üè® <strong>reception</strong> / <strong>lawmar2024!</strong> (R√©ception)</p>
                <p>üçΩÔ∏è <strong>restaurant</strong> / <strong>lawmar2024!</strong> (Restaurant)</p>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" style="display: none;">
        <div class="loader"></div>
    </div>

    <!-- Dashboard -->
    <div class="dashboard" id="dashboard">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <img src="images/logo1.png" alt="Lawmar" class="logo-img" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'50\' height=\'50\' viewBox=\'0 0 50 50\'%3E%3Crect width=\'50\' height=\'50\' fill=\'%23025ba5\'/%3E%3Ctext x=\'25\' y=\'35\' font-size=\'28\' text-anchor=\'middle\' fill=\'%23ffffff\' font-family=\'Arial\'%3ELAW%3C/text%3E%3C/svg%3E'">
                    <div class="logo-text">
                        <h1>LAWMAR PMS</h1>
                        <p>Les R√©sidences du Lawmar</p>
                    </div>
                </div>
            </div>
            
            <div class="sidebar-menu">
                <div class="menu-section">
                    <div class="menu-section-title">PRINCIPAL</div>
                    <div class="menu-item active" onclick="loadModule('dashboard')" data-module="dashboard">
                        <i class="fas fa-chart-pie"></i>
                        <span>Dashboard</span>
                        <div class="badge" id="dashboard-badge">0</div>
                    </div>
                    <div class="menu-item" onclick="loadModule('calendar')" data-module="calendar">
                        <i class="fas fa-calendar-alt"></i>
                        <span>Calendrier</span>
                    </div>
                    <div class="menu-item" onclick="loadModule('bookings')" data-module="bookings">
                        <i class="fas fa-hotel"></i>
                        <span>R√©servations</span>
                        <div class="badge" id="bookings-badge">0</div>
                    </div>
                    <div class="menu-item" onclick="loadModule('orders')" data-module="orders">
                        <i class="fas fa-utensils"></i>
                        <span>Commandes</span>
                        <div class="badge" id="orders-badge">0</div>
                    </div>
                    <div class="menu-item" onclick="loadModule('rooms')" data-module="rooms">
                        <i class="fas fa-door-open"></i>
                        <span>Chambres</span>
                    </div>
                </div>
                
                <div class="menu-section">
                    <div class="menu-section-title">GESTION</div>
                    <div class="menu-item" onclick="loadModule('guests')" data-module="guests">
                        <i class="fas fa-users"></i>
                        <span>Clients</span>
                    </div>
                    <div class="menu-item" onclick="loadModule('stock')" data-module="stock">
                        <i class="fas fa-boxes"></i>
                        <span>Stocks</span>
                    </div>
                    <div class="menu-item" onclick="loadModule('staff')" data-module="staff">
                        <i class="fas fa-users-cog"></i>
                        <span>Personnel</span>
                    </div>
                </div>
                
                <div class="menu-section">
                    <div class="menu-section-title">FINANCES</div>
                    <div class="menu-item" onclick="loadModule('invoices')" data-module="invoices">
                        <i class="fas fa-file-invoice"></i>
                        <span>Factures</span>
                    </div>
                    <div class="menu-item" onclick="loadModule('reports')" data-module="reports">
                        <i class="fas fa-chart-line"></i>
                        <span>Rapports</span>
                    </div>
                    <div class="menu-item" onclick="loadModule('expenses')" data-module="expenses">
                        <i class="fas fa-coins"></i>
                        <span>D√©penses</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main">
            <!-- Top Bar -->
            <div class="top-bar">
                <h2 class="page-title" id="page-title">Tableau de bord</h2>
                
                <div class="date-display">
                    <i class="fas fa-calendar-day"></i>
                    <span id="current-date"></span>
                </div>
                
                <div class="user-profile">
                    <div class="user-role" id="user-role">
                        <i class="fas fa-user-tie"></i> <span id="userRoleDisplay">Manager</span>
                    </div>
                    <div class="user-avatar" onclick="logout()" title="D√©connexion">
                        <span id="userInitials">AD</span>
                    </div>
                </div>
            </div>

            <!-- Role Tabs Modern -->
            <div class="role-tabs-modern">
                <div class="role-tab-modern active" onclick="switchRole('reception')" data-role="reception">
                    <i class="fas fa-hotel"></i> R√©ception
                </div>
                <div class="role-tab-modern" onclick="switchRole('restaurant')" data-role="restaurant">
                    <i class="fas fa-utensils"></i> Restaurant
                </div>
                <div class="role-tab-modern" onclick="switchRole('manager')" data-role="manager">
                    <i class="fas fa-chart-line"></i> Manager
                </div>
            </div>

            <!-- Dynamic Content Area -->
            <div id="dashboard-content">
                <!-- Le contenu est charg√© dynamiquement -->
            </div>
        </div>
    </div>

    <!-- Notification Center -->
    <div class="notification-center" id="notification-center"></div>

    <!-- Reservation Modal -->
    <div class="modal fade" id="reservationModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content modal-content-modern">
                <div class="modal-header-modern">
                    <h5 class="modal-title"><i class="fas fa-hotel me-2"></i> Nouvelle r√©servation</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body-modern">
                    <form id="reservationForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Nom du client</label>
                                <input type="text" class="form-control-modern w-100" id="guestName" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">T√©l√©phone</label>
                                <input type="tel" class="form-control-modern w-100" id="guestPhone" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Email</label>
                                <input type="email" class="form-control-modern w-100" id="guestEmail">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Chambre</label>
                                <select class="form-control-modern w-100" id="roomSelect" required>
                                    <option value="">S√©lectionner une chambre</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Date d'arriv√©e</label>
                                <input type="date" class="form-control-modern w-100" id="checkinDate" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Date de d√©part</label>
                                <input type="date" class="form-control-modern w-100" id="checkoutDate" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Adultes</label>
                                <input type="number" class="form-control-modern w-100" id="adults" value="1" min="1">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Enfants</label>
                                <input type="number" class="form-control-modern w-100" id="children" value="0" min="0">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Pr√©f√©rences sp√©ciales</label>
                            <textarea class="form-control-modern w-100" id="specialRequests" rows="3"></textarea>
                        </div>
                        <div class="alert alert-info">
                            <strong>Total estim√©: </strong> <span id="estimatedTotal">0</span> XOF
                        </div>
                        <div class="text-end">
                            <button type="button" class="btn-modern secondary me-2" data-bs-dismiss="modal">Annuler</button>
                            <button type="submit" class="btn-modern primary">Confirmer la r√©servation</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Order Modal -->
    <div class="modal fade" id="orderModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content modal-content-modern">
                <div class="modal-header-modern">
                    <h5 class="modal-title"><i class="fas fa-utensils me-2"></i> Nouvelle commande</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body-modern">
                    <form id="orderForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Num√©ro de table</label>
                                <input type="number" class="form-control-modern w-100" id="tableNumber" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Nom du client (optionnel)</label>
                                <input type="text" class="form-control-modern w-100" id="orderGuestName">
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Imputer √† la chambre ?</label>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="chargeToRoom">
                                <label class="form-check-label">Oui, imputer √† une chambre</label>
                            </div>
                        </div>
                        
                        <div class="mb-3" id="roomSelectionDiv" style="display: none;">
                            <label class="form-label">S√©lectionner la chambre</label>
                            <select class="form-control-modern w-100" id="chargeRoomSelect">
                                <option value="">Choisir une chambre</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Articles command√©s</label>
                            <div id="orderItems">
                                <div class="row mb-2 order-item">
                                    <div class="col-md-6">
                                        <select class="form-control-modern w-100 item-select">
                                            <option value="">S√©lectionner un article</option>
                                            <option value="Thieboudienne" data-price="12500">Thieboudienne - 12 500 XOF</option>
                                            <option value="Yassa Poulet" data-price="11000">Yassa Poulet - 11 000 XOF</option>
                                            <option value="Maf√© d'agneau" data-price="12000">Maf√© d'agneau - 12 000 XOF</option>
                                            <option value="Poulet DG" data-price="13800">Poulet DG - 13 800 XOF</option>
                                            <option value="Pastels" data-price="8000">Pastels - 8 000 XOF</option>
                                            <option value="Filet de Capitaine" data-price="14500">Filet de Capitaine - 14 500 XOF</option>
                                            <option value="Jus de bissap" data-price="3500">Jus de bissap - 3 500 XOF</option>
                                            <option value="Jus de gingembre" data-price="3500">Jus de gingembre - 3 500 XOF</option>
                                            <option value="Jus de bouye" data-price="4000">Jus de bouye - 4 000 XOF</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <input type="number" class="form-control-modern w-100 item-qty" value="1" min="1">
                                    </div>
                                    <div class="col-md-2">
                                        <span class="item-price-display">12 500</span> XOF
                                    </div>
                                    <div class="col-md-1">
                                        <button type="button" class="btn-icon danger remove-item" onclick="removeOrderItem(this)">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <button type="button" class="btn-modern secondary btn-sm mt-2" onclick="addOrderItem()">
                                <i class="fas fa-plus"></i> Ajouter un article
                            </button>
                        </div>
                        
                        <div class="alert alert-info">
                            <strong>Total commande: </strong> <span id="orderTotal">0</span> XOF
                        </div>
                        
                        <div class="text-end">
                            <button type="button" class="btn-modern secondary me-2" data-bs-dismiss="modal">Annuler</button>
                            <button type="submit" class="btn-modern primary">Valider la commande</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Invoice Modal -->
    <div class="modal fade" id="invoiceModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content modal-content-modern">
                <div class="modal-header-modern">
                    <h5 class="modal-title"><i class="fas fa-file-invoice me-2"></i> Facture</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body-modern" id="invoiceContent">
                    <!-- Contenu de la facture g√©n√©r√© dynamiquement -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-modern secondary" data-bs-dismiss="modal">Fermer</button>
                    <button type="button" class="btn-modern primary" onclick="downloadInvoicePDF()">
                        <i class="fas fa-download"></i> T√©l√©charger PDF
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // AUTHENTIFICATION OBLIGATOIRE
        // ============================================
        
        const users = [
            { username: 'admin', password: 'lawmar2024!', role: 'manager', name: 'Admin' },
            { username: 'reception', password: 'lawmar2024!', role: 'reception', name: 'R√©ceptionniste' },
            { username: 'restaurant', password: 'lawmar2024!', role: 'restaurant', name: 'Restaurateur' }
        ];

        // V√©rifier session
        if (sessionStorage.getItem('isLoggedIn') === 'true') {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('dashboard').style.display = 'flex';
            document.getElementById('loading-overlay').style.display = 'none';
        }

        // Gestionnaire de connexion
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            const loginBtn = document.getElementById('loginBtn');
            const alertDiv = document.getElementById('loginAlert');
            const alertMessage = document.getElementById('alertMessage');
            
            loginBtn.disabled = true;
            loginBtn.innerHTML = '<span class="loading-spinner"></span> Connexion...';
            
            setTimeout(() => {
                const user = users.find(u => u.username === username && u.password === password);
                
                if (user) {
                    sessionStorage.setItem('isLoggedIn', 'true');
                    sessionStorage.setItem('userRole', user.role);
                    sessionStorage.setItem('userName', user.name);
                    sessionStorage.setItem('username', user.username);
                    
                    document.getElementById('loginPage').style.display = 'none';
                    document.getElementById('dashboard').style.display = 'flex';
                    
                    initializeApp();
                    
                    showNotification(`Bienvenue ${user.name} !`, 'success');
                } else {
                    loginBtn.disabled = false;
                    loginBtn.innerHTML = 'Se connecter';
                    
                    alertMessage.textContent = 'Nom d\'utilisateur ou mot de passe incorrect';
                    alertDiv.style.display = 'block';
                    
                    setTimeout(() => {
                        alertDiv.style.display = 'none';
                    }, 5000);
                }
            }, 1000);
        });

        function logout() {
            if (confirm('√ätes-vous s√ªr de vouloir vous d√©connecter ?')) {
                sessionStorage.clear();
                window.location.reload();
            }
        }

        // ============================================
        // DONN√âES DE L'APPLICATION
        // ============================================
        
        let appData = {
            bookings: [
                { id: 'BK001', guest: 'Marie Diouf', room: 'Suite Prestige', roomNumber: 301, checkin: '2026-02-20', checkout: '2026-02-25', adults: 2, children: 1, status: 'confirmed', total: 750000, phone: '+221 77 123 45 67', email: 'marie.diouf@gmail.com', prepaid: 225000, specialRequests: 'Chambre calme' },
                { id: 'BK002', guest: 'Pierre Martin', room: 'Chambre Deluxe', roomNumber: 201, checkin: '2026-02-18', checkout: '2026-02-22', adults: 2, children: 0, status: 'checked-in', total: 380000, phone: '+221 78 234 56 78', email: 'pierre.martin@yahoo.fr', prepaid: 114000, specialRequests: '' },
                { id: 'BK003', guest: 'Aminata Ba', room: 'Chambre Standard', roomNumber: 102, checkin: '2026-02-15', checkout: '2026-02-19', adults: 1, children: 0, status: 'checked-out', total: 260000, phone: '+221 76 345 67 89', email: 'aminata.ba@gmail.com', prepaid: 78000, specialRequests: 'Vue piscine' },
                { id: 'BK004', guest: 'Jean Dupont', room: 'Suite Royale', roomNumber: 401, checkin: '2026-02-22', checkout: '2026-02-28', adults: 2, children: 2, status: 'confirmed', total: 2700000, phone: '+221 77 456 78 90', email: 'jean.dupont@orange.fr', prepaid: 540000, specialRequests: 'Lit b√©b√©' },
                { id: 'BK005', guest: 'Fatou Ndiaye', room: 'Chambre Deluxe', roomNumber: 202, checkin: '2026-02-19', checkout: '2026-02-23', adults: 2, children: 1, status: 'checked-in', total: 380000, phone: '+221 77 567 89 01', email: 'fatou.ndiaye@gmail.com', prepaid: 114000, specialRequests: '' },
                { id: 'BK006', guest: 'Omar Sy', room: 'Suite Prestige', roomNumber: 302, checkin: '2026-02-21', checkout: '2026-02-24', adults: 2, children: 0, status: 'confirmed', total: 450000, phone: '+221 77 678 90 12', email: 'omar.sy@icloud.com', prepaid: 135000, specialRequests: 'D√©jeuner inclus' },
                { id: 'BK007', guest: 'Sophie Diallo', room: 'Chambre Standard', roomNumber: 101, checkin: '2026-02-23', checkout: '2026-02-27', adults: 2, children: 1, status: 'pending', total: 260000, phone: '+221 78 789 01 23', email: 'sophie.diallo@gmail.com', prepaid: 0, specialRequests: '' },
            ],

            restaurantOrders: [
                { id: 'R001', table: 5, guest: 'Marie Diouf', items: [{ name: 'Thieboudienne', qty: 2, price: 12500 }, { name: 'Jus de bissap', qty: 2, price: 3500 }], total: 32000, status: 'paid', roomCharge: true, roomNumber: 301, roomId: 'BK001', time: '12:30', date: '2026-02-20' },
                { id: 'R002', table: 3, guest: 'Pierre Martin', items: [{ name: 'Yassa Poulet', qty: 1, price: 11000 }, { name: 'Pastels', qty: 1, price: 8000 }], total: 19000, status: 'pending', roomCharge: false, roomId: null, time: '19:15', date: '2026-02-20' },
                { id: 'R003', table: 2, guest: 'Aminata Ba', items: [{ name: 'Maf√© d\'agneau', qty: 1, price: 12000 }, { name: 'Jus de gingembre', qty: 1, price: 3500 }], total: 15500, status: 'preparing', roomCharge: false, roomId: null, time: '20:00', date: '2026-02-20' },
                { id: 'R004', table: 8, guest: 'Jean Dupont', items: [{ name: 'Filet de Capitaine', qty: 2, price: 14500 }, { name: 'Accra', qty: 1, price: 6500 }], total: 35500, status: 'paid', roomCharge: true, roomNumber: 401, roomId: 'BK004', time: '13:15', date: '2026-02-20' },
                { id: 'R005', table: 1, guest: 'Fatou Ndiaye', items: [{ name: 'Poulet DG', qty: 1, price: 13800 }, { name: 'Jus de bouye', qty: 1, price: 4000 }], total: 17800, status: 'preparing', roomCharge: false, roomId: null, time: '19:45', date: '2026-02-20' },
                { id: 'R006', table: 4, guest: 'Omar Sy', items: [{ name: 'Thieboudienne', qty: 1, price: 12500 }, { name: 'Yassa Poulet', qty: 1, price: 11000 }, { name: 'Bissap', qty: 2, price: 3500 }], total: 30500, status: 'paid', roomCharge: false, roomId: null, time: '20:30', date: '2026-02-20' },
                { id: 'R007', table: 6, guest: 'Sophie Diallo', items: [{ name: 'Pastels', qty: 2, price: 8000 }, { name: 'Jus de gingembre', qty: 1, price: 3500 }], total: 19500, status: 'pending', roomCharge: false, roomId: null, time: '12:45', date: '2026-02-20' },
            ],

            guests: [
                { id: 'G001', name: 'Marie Diouf', email: 'marie.diouf@gmail.com', phone: '+221 77 123 45 67', stays: 3, preferences: 'Chambre calme, oreillers fermes', totalSpent: 1850000, lastStay: '2026-02-20' },
                { id: 'G002', name: 'Pierre Martin', email: 'pierre.martin@yahoo.fr', phone: '+221 78 234 56 78', stays: 1, preferences: 'Petit-d√©jeuner continental', totalSpent: 380000, lastStay: '2026-02-18' },
                { id: 'G003', name: 'Aminata Ba', email: 'aminata.ba@gmail.com', phone: '+221 76 345 67 89', stays: 2, preferences: 'Chambre vue piscine', totalSpent: 520000, lastStay: '2026-02-15' },
                { id: 'G004', name: 'Jean Dupont', email: 'jean.dupont@orange.fr', phone: '+221 77 456 78 90', stays: 1, preferences: 'Suite avec jacuzzi', totalSpent: 2700000, lastStay: '2026-02-22' },
                { id: 'G005', name: 'Fatou Ndiaye', email: 'fatou.ndiaye@gmail.com', phone: '+221 77 567 89 01', stays: 1, preferences: 'Chambre proche piscine', totalSpent: 380000, lastStay: '2026-02-19' },
            ],

            stock: [
                { id: 'S001', name: 'Riz', category: '√©picerie', quantity: 25, unit: 'kg', threshold: 10, expiry: '2026-04-01', supplier: 'March√© Gandiol', price: 650 },
                { id: 'S002', name: 'Poisson frais', category: 'poissonnerie', quantity: 5, unit: 'kg', threshold: 8, expiry: '2026-02-22', supplier: 'P√™cheurs Tassin√®re', price: 2500 },
                { id: 'S003', name: 'Poulet', category: 'viande', quantity: 8, unit: 'kg', threshold: 5, expiry: '2026-02-25', supplier: 'Ferme de Gandiol', price: 1800 },
                { id: 'S004', name: 'Oignons', category: 'l√©gumes', quantity: 12, unit: 'kg', threshold: 5, expiry: '2026-02-28', supplier: 'March√© Gandiol', price: 500 },
                { id: 'S005', name: 'Huile', category: '√©picerie', quantity: 15, unit: 'L', threshold: 5, expiry: '2026-05-01', supplier: 'Saint-Louis', price: 1200 },
            ],

            employees: [
                { id: 'E001', name: 'Oumar Diallo', role: 'serveur', department: 'restaurant', phone: '+221 77 111 22 33', schedule: 'Lun-Ven 8h-17h', email: 'oumar.diallo@lawmar.sn' },
                { id: 'E002', name: 'Fatou Ndiaye', role: 'r√©ceptionniste', department: 'reception', phone: '+221 77 444 55 66', schedule: 'Mar-Sam 14h-22h', email: 'fatou.ndiaye@lawmar.sn' },
                { id: 'E003', name: 'Moussa Sow', role: 'cuisinier', department: 'restaurant', phone: '+221 77 777 88 99', schedule: 'Lun-Dim 10h-19h', email: 'moussa.sow@lawmar.sn' },
                { id: 'E004', name: 'Aminata Fall', role: 'manager', department: 'direction', phone: '+221 77 999 00 11', schedule: 'Lun-Ven 9h-18h', email: 'aminata.fall@lawmar.sn' },
            ],

            expenses: [
                { id: 'EX001', date: '2026-02-15', category: '√©lectricit√©', amount: 85000, description: 'Facture Senelec', paid: true, dueDate: '2026-02-28' },
                { id: 'EX002', date: '2026-02-10', category: 'achats', amount: 125000, description: 'Approvisionnement restaurant', paid: true, dueDate: '2026-02-20' },
                { id: 'EX003', date: '2026-02-18', category: 'eau', amount: 35000, description: 'Facture SDE', paid: false, dueDate: '2026-03-05' },
                { id: 'EX004', date: '2026-02-20', category: 'salaire', amount: 450000, description: 'Salaires f√©vrier', paid: true, dueDate: '2026-02-28' },
            ],

            rooms: [
                { number: 101, type: 'Standard', price: 65000, status: 'available' },
                { number: 102, type: 'Standard', price: 65000, status: 'occupied', guest: 'Aminata Ba' },
                { number: 201, type: 'Deluxe', price: 95000, status: 'occupied', guest: 'Pierre Martin' },
                { number: 202, type: 'Deluxe', price: 95000, status: 'available' },
                { number: 301, type: 'Prestige', price: 150000, status: 'occupied', guest: 'Marie Diouf' },
                { number: 302, type: 'Prestige', price: 150000, status: 'available' },
                { number: 401, type: 'Royale', price: 450000, status: 'reserved', guest: 'Jean Dupont' },
            ],

            get stats() {
                const today = new Date().toISOString().split('T')[0];
                const totalRooms = this.rooms.length;
                const occupiedRooms = this.rooms.filter(r => r.status === 'occupied' || r.status === 'reserved').length;
                const occupancyRate = Math.round((occupiedRooms / totalRooms) * 100);
                
                const checkinsToday = this.bookings.filter(b => b.checkin === today).length;
                const checkoutsToday = this.bookings.filter(b => b.checkout === today).length;
                
                const hotelRevenue = this.bookings.reduce((sum, b) => sum + b.total, 0);
                const restaurantRevenue = this.restaurantOrders.reduce((sum, o) => sum + o.total, 0);
                
                const pendingOrders = this.restaurantOrders.filter(o => o.status === 'pending' || o.status === 'preparing').length;
                
                const lowStock = this.stock.filter(s => s.quantity <= s.threshold).length;
                
                return {
                    occupancyRate,
                    occupiedRooms,
                    totalRooms,
                    checkinsToday,
                    checkoutsToday,
                    hotelRevenue,
                    restaurantRevenue,
                    pendingOrders,
                    lowStock
                };
            }
        };

        let currentRole = sessionStorage.getItem('userRole') || 'reception';
        let currentModule = 'dashboard';
        let charts = {};
        let currentInvoice = null;
        let invoiceCounter = 1;

        // ========== INITIALISATION ==========
        function initializeApp() {
            updateDate();
            
            const userName = sessionStorage.getItem('userName') || 'Utilisateur';
            const userRole = sessionStorage.getItem('userRole') || 'reception';
            
            document.getElementById('userRoleDisplay').textContent = 
                userRole === 'manager' ? 'Manager' : 
                userRole === 'reception' ? 'R√©ception' : 'Restaurant';
            document.getElementById('userInitials').textContent = userName.charAt(0).toUpperCase();
            
            updateBadges();
            loadDashboard();
            setupForms();
            initEventListeners();
        }

        function updateDate() {
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('current-date').textContent = new Date().toLocaleDateString('fr-FR', options);
        }

        function updateBadges() {
            document.getElementById('dashboard-badge').textContent = appData.stats.pendingOrders;
            document.getElementById('bookings-badge').textContent = appData.bookings.filter(b => b.status === 'pending').length;
            document.getElementById('orders-badge').textContent = appData.restaurantOrders.filter(o => o.status === 'pending' || o.status === 'preparing').length;
        }

        function initEventListeners() {
            setInterval(() => { refreshData(); }, 30000);

            document.getElementById('chargeToRoom')?.addEventListener('change', function(e) {
                document.getElementById('roomSelectionDiv').style.display = e.target.checked ? 'block' : 'none';
            });

            document.addEventListener('change', function(e) {
                if (e.target.classList.contains('item-select') || e.target.classList.contains('item-qty')) {
                    calculateOrderTotal();
                }
            });

            document.getElementById('roomSelect')?.addEventListener('change', calculateEstimatedTotal);
            document.getElementById('checkinDate')?.addEventListener('change', calculateEstimatedTotal);
            document.getElementById('checkoutDate')?.addEventListener('change', calculateEstimatedTotal);
        }

        function refreshData() {
            showNotification('Donn√©es synchronis√©es', 'success');
            loadModule(currentModule);
            updateBadges();
        }

        function setupForms() {
            document.getElementById('reservationForm')?.addEventListener('submit', function(e) {
                e.preventDefault();
                submitReservation();
            });

            document.getElementById('orderForm')?.addEventListener('submit', function(e) {
                e.preventDefault();
                submitOrder();
            });

            updateRoomSelectors();
        }

        function updateRoomSelectors() {
            const roomSelect = document.getElementById('roomSelect');
            const chargeRoomSelect = document.getElementById('chargeRoomSelect');
            
            if (roomSelect) {
                roomSelect.innerHTML = '<option value="">S√©lectionner une chambre</option>';
                appData.rooms.filter(r => r.status === 'available').forEach(room => {
                    roomSelect.innerHTML += `<option value="${room.number}" data-price="${room.price}">${room.number} - ${room.type} (${room.price.toLocaleString()} XOF/nuit)</option>`;
                });
            }
            
            if (chargeRoomSelect) {
                chargeRoomSelect.innerHTML = '<option value="">Choisir une chambre</option>';
                appData.rooms.filter(r => r.status === 'occupied').forEach(room => {
                    chargeRoomSelect.innerHTML += `<option value="${room.number}">${room.number} - ${room.type} (Occup√© par ${room.guest})</option>`;
                });
            }
        }

        function calculateEstimatedTotal() {
            const roomSelect = document.getElementById('roomSelect');
            const checkin = document.getElementById('checkinDate').value;
            const checkout = document.getElementById('checkoutDate').value;
            
            if (roomSelect.value && checkin && checkout) {
                const selectedOption = roomSelect.options[roomSelect.selectedIndex];
                const pricePerNight = parseInt(selectedOption.dataset.price);
                const nights = Math.ceil((new Date(checkout) - new Date(checkin)) / (1000 * 60 * 60 * 24));
                const total = pricePerNight * nights;
                document.getElementById('estimatedTotal').textContent = total.toLocaleString();
            }
        }

        function switchRole(role) {
            currentRole = role;
            
            document.querySelectorAll('.role-tab-modern').forEach(tab => {
                tab.classList.remove('active');
                if (tab.dataset.role === role) {
                    tab.classList.add('active');
                }
            });
            
            const roleLabels = {
                reception: 'R√©ception',
                restaurant: 'Restaurant',
                manager: 'Manager'
            };
            document.getElementById('userRoleDisplay').textContent = roleLabels[role];
            
            loadModule(currentModule);
            
            showNotification(`Mode ${roleLabels[role]} activ√©`, 'success');
        }

        function loadModule(module) {
            currentModule = module;
            
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.module === module) {
                    item.classList.add('active');
                }
            });
            
            const titles = {
                dashboard: 'Tableau de bord',
                calendar: 'Calendrier des r√©servations',
                bookings: 'Gestion des r√©servations',
                orders: 'Commandes restaurant',
                rooms: 'Gestion des chambres',
                guests: 'Fiches clients',
                stock: 'Gestion des stocks',
                staff: 'Personnel',
                invoices: 'Facturation',
                reports: 'Rapports',
                expenses: 'D√©penses'
            };
            document.getElementById('page-title').textContent = titles[module] || 'Tableau de bord';
            
            loadModuleContent(module);
        }

        function loadModuleContent(module) {
            const content = document.getElementById('dashboard-content');
            
            if (module === 'dashboard') {
                content.innerHTML = renderDashboard();
                setTimeout(() => { initCharts(); }, 100);
            } else if (module === 'calendar') {
                content.innerHTML = renderCalendar();
                setTimeout(() => { initCalendar(); }, 100);
            } else if (module === 'bookings') {
                content.innerHTML = renderBookings();
                setTimeout(() => { initDataTable('#bookings-table'); }, 100);
            } else if (module === 'orders') {
                content.innerHTML = renderOrders();
                setTimeout(() => { initDataTable('#orders-table'); }, 100);
            } else if (module === 'rooms') {
                content.innerHTML = renderRooms();
            } else if (module === 'guests') {
                content.innerHTML = renderGuests();
            } else if (module === 'stock') {
                content.innerHTML = renderStock();
            } else if (module === 'staff') {
                content.innerHTML = renderStaff();
            } else if (module === 'invoices') {
                content.innerHTML = renderInvoices();
            } else if (module === 'reports') {
                content.innerHTML = renderReports();
                setTimeout(() => { initReportsCharts(); }, 100);
            } else if (module === 'expenses') {
                content.innerHTML = renderExpenses();
            }
        }

        // ========== FONCTIONS DE RENDU ==========
        function renderDashboard() {
            const stats = appData.stats;
            
            let roleSpecificContent = '';
            if (currentRole === 'reception') {
                roleSpecificContent = renderReceptionDashboard();
            } else if (currentRole === 'restaurant') {
                roleSpecificContent = renderRestaurantDashboard();
            } else {
                roleSpecificContent = renderManagerDashboard();
            }
            
            return `
                <div class="stats-grid">
                    <div class="stat-card-modern">
                        <div class="stat-header">
                            <div class="stat-icon-modern primary"><i class="fas fa-hotel"></i></div>
                            <span class="badge-modern badge-info">${stats.occupiedRooms}/${stats.totalRooms}</span>
                        </div>
                        <div class="stat-value-modern">${stats.occupancyRate}%</div>
                        <div class="stat-label-modern">Taux d'occupation</div>
                        <div class="stat-trend"><span class="trend-up"><i class="fas fa-arrow-up"></i> +8%</span><span>vs hier</span></div>
                        <small class="text-muted">Arriv√©es: ${stats.checkinsToday} | D√©parts: ${stats.checkoutsToday}</small>
                    </div>
                    <div class="stat-card-modern">
                        <div class="stat-header"><div class="stat-icon-modern success"><i class="fas fa-chart-line"></i></div></div>
                        <div class="stat-value-modern">${(stats.hotelRevenue / 1000000).toFixed(1)}M</div>
                        <div class="stat-label-modern">CA H√¥tel (XOF)</div>
                        <div class="stat-trend"><span class="trend-up"><i class="fas fa-arrow-up"></i> +15%</span><span>ce mois</span></div>
                    </div>
                    <div class="stat-card-modern">
                        <div class="stat-header"><div class="stat-icon-modern warning"><i class="fas fa-utensils"></i></div></div>
                        <div class="stat-value-modern">${(stats.restaurantRevenue / 1000).toFixed(0)}k</div>
                        <div class="stat-label-modern">CA Restaurant (XOF)</div>
                        <div class="stat-trend"><span class="trend-up"><i class="fas fa-arrow-up"></i> +5%</span><span>vs hier</span></div>
                        <small class="text-muted">${stats.pendingOrders} commandes en cours</small>
                    </div>
                    <div class="stat-card-modern">
                        <div class="stat-header"><div class="stat-icon-modern danger"><i class="fas fa-exclamation-triangle"></i></div></div>
                        <div class="stat-value-modern">${stats.lowStock}</div>
                        <div class="stat-label-modern">Alertes stock</div>
                        <small class="text-muted">Produits sous seuil</small>
                    </div>
                </div>
                
                <div class="charts-grid">
                    <div class="chart-card">
                        <div class="chart-header"><h3><i class="fas fa-chart-bar"></i> Occupation 7 derniers jours</h3><i class="fas fa-ellipsis-h"></i></div>
                        <canvas id="occupancy-chart" style="height: 250px;"></canvas>
                    </div>
                    <div class="chart-card">
                        <div class="chart-header"><h3><i class="fas fa-chart-pie"></i> R√©partition des revenus</h3><i class="fas fa-ellipsis-h"></i></div>
                        <canvas id="revenue-chart" style="height: 250px;"></canvas>
                    </div>
                </div>
                
                ${roleSpecificContent}
            `;
        }

        function renderReceptionDashboard() {
            const today = new Date().toISOString().split('T')[0];
            const todayCheckins = appData.bookings.filter(b => b.checkin === today);
            const todayCheckouts = appData.bookings.filter(b => b.checkout === today);
            
            return `
                <div class="room-grid">
                    ${appData.rooms.filter(r => r.status === 'available').slice(0, 4).map(room => `
                        <div class="room-card available" onclick="quickReserve(${room.number})">
                            <div class="d-flex justify-content-between"><span class="room-number">Ch. ${room.number}</span><span class="badge-modern badge-success">Disponible</span></div>
                            <div class="room-type">${room.type}</div><div class="room-price">${room.price.toLocaleString()} XOF/nuit</div>
                        </div>`).join('')}
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="table-card">
                            <div class="table-header"><h3><i class="fas fa-sign-in-alt" style="color: #28a745;"></i> Arriv√©es aujourd'hui</h3><span class="badge-modern badge-success">${todayCheckins.length}</span></div>
                            <table class="table"><thead><tr><th>Client</th><th>Chambre</th><th>Heure</th><th>Statut</th><th>Action</th></tr></thead><tbody>
                                ${todayCheckins.length ? todayCheckins.map(b => `<tr><td><strong>${b.guest}</strong></td><td>${b.room}</td><td>14:00</td><td><span class="badge-modern badge-info">Attente</span></td><td><button class="btn-icon" onclick="checkIn('${b.id}')"><i class="fas fa-check"></i></button></td></tr>`).join('') : '<tr><td colspan="5" class="text-center">Aucune arriv√©e aujourd\'hui</td></tr>'}
                            </tbody></table>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="table-card">
                            <div class="table-header"><h3><i class="fas fa-sign-out-alt" style="color: #dc3545;"></i> D√©parts aujourd'hui</h3><span class="badge-modern badge-danger">${todayCheckouts.length}</span></div>
                            <table class="table"><thead><tr><th>Client</th><th>Chambre</th><th>Heure</th><th>Facture</th><th>Action</th></tr></thead><tbody>
                                ${todayCheckouts.length ? todayCheckouts.map(b => `<tr><td><strong>${b.guest}</strong></td><td>${b.room}</td><td>11:00</td><td><button class="btn-icon" onclick="showInvoice('${b.id}')"><i class="fas fa-file-pdf"></i></button></td><td><button class="btn-icon" onclick="checkOut('${b.id}')"><i class="fas fa-check"></i></button></td></tr>`).join('') : '<tr><td colspan="5" class="text-center">Aucun d√©part aujourd\'hui</td></tr>'}
                            </tbody></table>
                        </div>
                    </div>
                </div>
                
                <div class="table-card mt-3">
                    <div class="table-header"><h3><i class="fas fa-calendar-alt"></i> Prochaines r√©servations</h3><button class="btn-modern primary" onclick="openReservationModal()"><i class="fas fa-plus"></i> Nouvelle r√©servation</button></div>
                    <table class="table" id="dashboard-bookings-table"><thead><tr><th>N¬∞</th><th>Client</th><th>Chambre</th><th>Arriv√©e</th><th>D√©part</th><th>Montant</th><th>Statut</th><th>Actions</th></tr></thead><tbody>
                        ${appData.bookings.slice(0, 5).map(b => `<tr><td><strong>${b.id}</strong></td><td>${b.guest}<br><small>${b.phone}</small></td><td>${b.room}</td><td>${formatDate(b.checkin)}</td><td>${formatDate(b.checkout)}</td><td>${(b.total / 1000).toFixed(0)}k XOF</td><td><span class="badge-modern ${getStatusClass(b.status)}">${getStatusLabel(b.status)}</span></td><td><button class="btn-icon" onclick="viewBooking('${b.id}')"><i class="fas fa-eye"></i></button><button class="btn-icon" onclick="showInvoice('${b.id}')"><i class="fas fa-file-pdf"></i></button></td></tr>`).join('')}
                    </tbody></table>
                </div>
            `;
        }

        function renderRestaurantDashboard() {
            const preparing = appData.restaurantOrders.filter(o => o.status === 'preparing');
            const pending = appData.restaurantOrders.filter(o => o.status === 'pending');
            
            return `
                <div class="row">
                    <div class="col-md-8">
                        <div class="table-card">
                            <div class="table-header"><h3><i class="fas fa-utensils"></i> Commandes en cours</h3><button class="btn-modern primary" onclick="openOrderModal()"><i class="fas fa-plus"></i> Nouvelle commande</button></div>
                            <table class="table" id="dashboard-orders-table"><thead><tr><th>N¬∞</th><th>Table</th><th>Client</th><th>Articles</th><th>Total</th><th>Heure</th><th>Statut</th><th>Actions</th></tr></thead><tbody>
                                ${appData.restaurantOrders.slice(0, 5).map(o => `<tr><td><strong>${o.id}</strong></td><td><span class="badge-modern badge-info">Table ${o.table}</span></td><td>${o.guest || 'Anonyme'}</td><td>${o.items.length} article(s)</td><td>${(o.total / 1000).toFixed(0)}k XOF</td><td>${o.time}</td><td><span class="badge-modern ${o.status === 'paid' ? 'badge-success' : o.status === 'preparing' ? 'badge-warning' : 'badge-info'}">${getOrderStatusLabel(o.status)}</span></td><td><button class="btn-icon" onclick="viewOrder('${o.id}')"><i class="fas fa-eye"></i></button>${o.status === 'preparing' ? `<button class="btn-icon success" onclick="markOrderReady('${o.id}')"><i class="fas fa-check"></i></button>` : ''}<button class="btn-icon" onclick="showOrderInvoice('${o.id}')"><i class="fas fa-file-invoice"></i></button></td></tr>`).join('')}
                            </tbody></table>
                        </div>
                    </div>
                    
                    <div class="col-md-4">
                        <div class="table-card">
                            <h3><i class="fas fa-fire"></i> En cuisine</h3>
                            <div class="kitchen-orders">
                                ${preparing.map(o => `<div class="kitchen-card"><div class="kitchen-header"><span class="table-number">Table ${o.table}</span><span class="timer"><i class="far fa-clock"></i> ${calculateTimeSince(o.time)}</span></div><ul class="kitchen-items">${o.items.map(item => `<li>${item.qty}x ${item.name}</li>`).join('')}</ul><button class="btn-modern success btn-sm w-100" onclick="markOrderReady('${o.id}')"><i class="fas fa-check"></i> Pr√™t</button></div>`).join('')}
                                ${preparing.length === 0 ? '<p class="text-muted text-center">Aucune commande en cuisine</p>' : ''}
                            </div>
                        </div>
                        
                        <div class="table-card mt-3">
                            <h3><i class="fas fa-chart-simple"></i> Statistiques du jour</h3>
                            <canvas id="restaurant-stats" style="height: 200px;"></canvas>
                            <div class="mt-3"><p><strong>Total encaiss√©:</strong> ${(appData.restaurantOrders.filter(o => o.status === 'paid').reduce((sum, o) => sum + o.total, 0) / 1000).toFixed(0)}k XOF</p><p><strong>Commandes imput√©es:</strong> ${appData.restaurantOrders.filter(o => o.roomCharge).length}</p></div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderManagerDashboard() {
            const totalRevenue = appData.stats.hotelRevenue + appData.stats.restaurantRevenue;
            const expensesTotal = appData.expenses.reduce((sum, e) => sum + e.amount, 0);
            const profit = totalRevenue - expensesTotal;
            
            return `
                <div class="stats-grid">
                    <div class="stat-card-modern"><div class="stat-header"><div class="stat-icon-modern primary"><i class="fas fa-chart-line"></i></div></div><div class="stat-value-modern">${(totalRevenue / 1000000).toFixed(1)}M</div><div class="stat-label-modern">CA Total (XOF)</div></div>
                    <div class="stat-card-modern"><div class="stat-header"><div class="stat-icon-modern success"><i class="fas fa-coins"></i></div></div><div class="stat-value-modern">${(profit / 1000000).toFixed(1)}M</div><div class="stat-label-modern">B√©n√©fice net</div></div>
                    <div class="stat-card-modern"><div class="stat-header"><div class="stat-icon-modern warning"><i class="fas fa-users"></i></div></div><div class="stat-value-modern">${appData.employees.length}</div><div class="stat-label-modern">Employ√©s</div></div>
                    <div class="stat-card-modern"><div class="stat-header"><div class="stat-icon-modern danger"><i class="fas fa-file-invoice"></i></div></div><div class="stat-value-modern">${appData.expenses.filter(e => !e.paid).length}</div><div class="stat-label-modern">Factures impay√©es</div></div>
                </div>
                
                <div class="row">
                    <div class="col-md-6"><div class="table-card"><h3><i class="fas fa-chart-bar"></i> Performance mensuelle</h3><canvas id="performance-chart" style="height: 250px;"></canvas></div></div>
                    <div class="col-md-6"><div class="table-card"><h3><i class="fas fa-file-invoice"></i> Derni√®res factures</h3><table class="table"><thead><tr><th>N¬∞</th><th>Client</th><th>Montant</th><th>Statut</th><th>Action</th></tr></thead><tbody>${appData.bookings.slice(0, 5).map(b => `<tr><td>${b.id}</td><td>${b.guest}</td><td>${(b.total / 1000).toFixed(0)}k XOF</td><td><span class="badge-modern badge-success">Pay√©e</span></td><td><button class="btn-icon" onclick="showInvoice('${b.id}')"><i class="fas fa-file-pdf"></i></button></td></tr>`).join('')}</tbody></table></div></div>
                </div>
                
                <div class="row mt-3">
                    <div class="col-md-6"><div class="table-card"><h3><i class="fas fa-exclamation-triangle"></i> Alertes stock</h3>${appData.stock.filter(s => s.quantity <= s.threshold).map(s => `<div class="alert alert-warning d-flex justify-content-between align-items-center"><div><strong>${s.name}</strong> - ${s.quantity} ${s.unit} restants<br><small>Seuil: ${s.threshold} ${s.unit}</small></div><button class="btn-modern warning btn-sm" onclick="orderStock('${s.id}')">Commander</button></div>`).join('') || '<p class="text-muted">Aucune alerte stock</p>'}</div></div>
                    <div class="col-md-6"><div class="table-card"><h3><i class="fas fa-calendar-check"></i> √âquipe aujourd'hui</h3>${appData.employees.map(e => `<div class="d-flex justify-content-between align-items-center mb-2 p-2 bg-light rounded"><div><strong>${e.name}</strong><br><small>${e.role}</small></div><span class="badge-modern badge-success">Pr√©sent</span></div>`).join('')}</div></div>
                </div>
            `;
        }

        function renderBookings() {
            return `
                <div class="table-card">
                    <div class="table-header"><h3><i class="fas fa-hotel"></i> Toutes les r√©servations</h3><button class="btn-modern primary" onclick="openReservationModal()"><i class="fas fa-plus"></i> Nouvelle r√©servation</button></div>
                    <div class="table-responsive"><table class="table" id="bookings-table"><thead><tr><th>ID</th><th>Client</th><th>Chambre</th><th>Arriv√©e</th><th>D√©part</th><th>Adultes</th><th>Enfants</th><th>Total</th><th>Statut</th><th>Actions</th></tr></thead><tbody>
                        ${appData.bookings.map(b => `<tr><td>${b.id}</td><td>${b.guest}<br><small>${b.phone}</small></td><td>${b.room}</td><td>${formatDate(b.checkin)}</td><td>${formatDate(b.checkout)}</td><td>${b.adults}</td><td>${b.children}</td><td>${(b.total / 1000).toFixed(0)}k XOF</td><td><span class="badge-modern ${getStatusClass(b.status)}">${getStatusLabel(b.status)}</span></td><td><button class="btn-icon" onclick="viewBooking('${b.id}')"><i class="fas fa-eye"></i></button><button class="btn-icon" onclick="showInvoice('${b.id}')"><i class="fas fa-file-pdf"></i></button><button class="btn-icon danger" onclick="deleteBooking('${b.id}')"><i class="fas fa-trash"></i></button></td></tr>`).join('')}
                    </tbody></table></div>
                </div>
            `;
        }

        function renderOrders() {
            return `
                <div class="table-card">
                    <div class="table-header"><h3><i class="fas fa-utensils"></i> Commandes restaurant</h3><button class="btn-modern primary" onclick="openOrderModal()"><i class="fas fa-plus"></i> Nouvelle commande</button></div>
                    <div class="table-responsive"><table class="table" id="orders-table"><thead><tr><th>ID</th><th>Table</th><th>Client</th><th>Articles</th><th>Total</th><th>Heure</th><th>Statut</th><th>Imputation</th><th>Actions</th></tr></thead><tbody>
                        ${appData.restaurantOrders.map(o => `<tr><td>${o.id}</td><td><span class="badge-modern badge-info">${o.table}</span></td><td>${o.guest || 'Anonyme'}</td><td>${o.items.map(i => `${i.qty}x ${i.name}`).join(', ')}</td><td>${(o.total / 1000).toFixed(0)}k XOF</td><td>${o.time}</td><td><span class="badge-modern ${o.status === 'paid' ? 'badge-success' : o.status === 'preparing' ? 'badge-warning' : 'badge-info'}">${getOrderStatusLabel(o.status)}</span></td><td>${o.roomCharge ? `<i class="fas fa-hotel text-primary"></i> Ch. ${o.roomNumber}` : '-'}</td><td><button class="btn-icon" onclick="viewOrder('${o.id}')"><i class="fas fa-eye"></i></button>${o.status === 'preparing' ? `<button class="btn-icon success" onclick="markOrderReady('${o.id}')"><i class="fas fa-check"></i></button>` : ''}<button class="btn-icon" onclick="showOrderInvoice('${o.id}')"><i class="fas fa-file-invoice"></i></button><button class="btn-icon danger" onclick="deleteOrder('${o.id}')"><i class="fas fa-trash"></i></button></td></tr>`).join('')}
                    </tbody></table></div>
                </div>
            `;
        }

        function renderRooms() {
            return `
                <div class="table-card">
                    <div class="table-header"><h3><i class="fas fa-door-open"></i> Gestion des chambres</h3><button class="btn-modern primary" onclick="openRoomModal()"><i class="fas fa-plus"></i> Ajouter chambre</button></div>
                    <div class="room-grid">${appData.rooms.map(room => `<div class="room-card ${room.status}" onclick="viewRoom(${room.number})"><div class="d-flex justify-content-between"><span class="room-number">Ch. ${room.number}</span><span class="badge-modern ${room.status === 'available' ? 'badge-success' : room.status === 'occupied' ? 'badge-info' : room.status === 'reserved' ? 'badge-warning' : 'badge-danger'}">${room.status === 'available' ? 'Disponible' : room.status === 'occupied' ? 'Occup√©e' : room.status === 'reserved' ? 'R√©serv√©e' : 'Maintenance'}</span></div><div class="room-type">${room.type}</div><div class="room-price">${room.price.toLocaleString()} XOF/nuit</div>${room.guest ? `<small class="text-muted">Occup√© par: ${room.guest}</small>` : ''}</div>`).join('')}</div>
                    <div class="mt-4"><h4>L√©gende</h4><div class="d-flex gap-3"><span><span class="badge-modern badge-success">Disponible</span></span><span><span class="badge-modern badge-info">Occup√©e</span></span><span><span class="badge-modern badge-warning">R√©serv√©e</span></span><span><span class="badge-modern badge-danger">Maintenance</span></span></div></div>
                </div>
            `;
        }

        function renderCalendar() {
            return `<div class="table-card"><div id="calendar" style="height: 600px;"></div></div>`;
        }

        function renderGuests() {
            return `
                <div class="table-card">
                    <div class="table-header"><h3><i class="fas fa-users"></i> Fiches clients</h3><button class="btn-modern primary" onclick="openGuestModal()"><i class="fas fa-user-plus"></i> Nouveau client</button></div>
                    ${appData.guests.map(g => `<div class="card mb-3 p-3"><div class="row"><div class="col-md-3"><h5>${g.name}</h5><p class="mb-1"><i class="fas fa-envelope me-2"></i> ${g.email}</p><p class="mb-1"><i class="fas fa-phone me-2"></i> ${g.phone}</p></div><div class="col-md-2"><strong>S√©jours: ${g.stays}</strong><br><small>D√©p. totale: ${(g.totalSpent / 1000000).toFixed(1)}M XOF</small></div><div class="col-md-4"><strong>Pr√©f√©rences:</strong><p>${g.preferences}</p></div><div class="col-md-3"><strong>Dernier s√©jour:</strong> ${formatDate(g.lastStay)}<div class="mt-2"><button class="btn-icon" onclick="viewGuest('${g.id}')"><i class="fas fa-eye"></i></button><button class="btn-icon" onclick="generateGuestInvoice('${g.id}')"><i class="fas fa-file-pdf"></i></button></div></div></div></div>`).join('')}
                </div>
                <div class="table-card mt-3"><h3><i class="fas fa-history"></i> Historique des s√©jours</h3><table class="table"><thead><tr><th>Client</th><th>P√©riode</th><th>Chambre</th><th>Montant</th><th>Facture</th></tr></thead><tbody>${appData.bookings.map(b => `<tr><td>${b.guest}</td><td>${formatDate(b.checkin)} - ${formatDate(b.checkout)}</td><td>${b.room}</td><td>${(b.total / 1000).toFixed(0)}k XOF</td><td><button class="btn-icon" onclick="showInvoice('${b.id}')"><i class="fas fa-file-pdf"></i></button></td></tr>`).join('')}</tbody></table></div>
            `;
        }

        function renderStock() {
            return `
                <div class="table-card">
                    <div class="table-header"><h3><i class="fas fa-boxes"></i> Gestion des stocks</h3><button class="btn-modern primary" onclick="openStockModal()"><i class="fas fa-plus"></i> Ajouter article</button></div>
                    <div class="row mb-4"><div class="col-md-3"><div class="stat-card-modern p-3"><div class="stat-value-modern">${appData.stock.length}</div><div class="stat-label-modern">Total articles</div></div></div><div class="col-md-3"><div class="stat-card-modern p-3"><div class="stat-value-modern text-warning">${appData.stock.filter(s => s.quantity <= s.threshold).length}</div><div class="stat-label-modern">Alertes</div></div></div></div>
                    <table class="table"><thead><tr><th>Article</th><th>Cat√©gorie</th><th>Quantit√©</th><th>Seuil</th><th>Expiration</th><th>Fournisseur</th><th>Actions</th></tr></thead><tbody>${appData.stock.map(s => `<tr class="${s.quantity <= s.threshold ? 'table-warning' : ''}"><td><strong>${s.name}</strong></td><td>${s.category}</td><td>${s.quantity} ${s.unit}</td><td>${s.threshold} ${s.unit}</td><td>${s.expiry ? formatDate(s.expiry) : '-'}${s.expiry && new Date(s.expiry) < new Date() ? '<span class="badge-modern badge-danger">P√©rim√©</span>' : ''}</td><td>${s.supplier}</td><td><button class="btn-icon" onclick="editStock('${s.id}')"><i class="fas fa-edit"></i></button><button class="btn-icon" onclick="orderStock('${s.id}')"><i class="fas fa-shopping-cart"></i></button></td></tr>`).join('')}</tbody></table>
                </div>
            `;
        }

        function renderStaff() {
            return `
                <div class="table-card">
                    <div class="table-header"><h3><i class="fas fa-users-cog"></i> Personnel</h3><button class="btn-modern primary" onclick="openEmployeeModal()"><i class="fas fa-user-plus"></i> Ajouter employ√©</button></div>
                    <div class="row mb-4"><div class="col-md-3"><div class="stat-card-modern p-3"><div class="stat-value-modern">${appData.employees.length}</div><div class="stat-label-modern">Total employ√©s</div></div></div><div class="col-md-3"><div class="stat-card-modern p-3"><div class="stat-value-modern">${appData.employees.filter(e => e.department === 'restaurant').length}</div><div class="stat-label-modern">Restaurant</div></div></div><div class="col-md-3"><div class="stat-card-modern p-3"><div class="stat-value-modern">${appData.employees.filter(e => e.department === 'reception').length}</div><div class="stat-label-modern">R√©ception</div></div></div></div>
                    <table class="table"><thead><tr><th>Nom</th><th>R√¥le</th><th>D√©partement</th><th>T√©l√©phone</th><th>Email</th><th>Planning</th><th>Actions</th></tr></thead><tbody>${appData.employees.map(e => `<tr><td><strong>${e.name}</strong></td><td>${e.role}</td><td>${e.department}</td><td>${e.phone}</td><td>${e.email}</td><td>${e.schedule}</td><td><button class="btn-icon" onclick="editEmployee('${e.id}')"><i class="fas fa-edit"></i></button></td></tr>`).join('')}</tbody></table>
                </div>
            `;
        }

        function renderInvoices() {
            return `
                <div class="table-card">
                    <div class="table-header"><h3><i class="fas fa-file-invoice"></i> Factures</h3><button class="btn-modern primary" onclick="generateNewInvoice()"><i class="fas fa-plus"></i> Nouvelle facture</button></div>
                    <table class="table"><thead><tr><th>N¬∞ Facture</th><th>Client</th><th>Date</th><th>Montant</th><th>Statut</th><th>Actions</th></tr></thead><tbody>
                        ${appData.bookings.map((b, idx) => `<tr><td><strong>FAC-${String(idx+1).padStart(4,'0')}</strong></td><td>${b.guest}</td><td>${formatDate(b.checkout)}</td><td>${(b.total / 1000).toFixed(0)}k XOF</td><td><span class="badge-modern ${b.status === 'checked-out' ? 'badge-success' : 'badge-warning'}">${b.status === 'checked-out' ? 'Pay√©e' : 'En attente'}</span></td><td><button class="btn-icon" onclick="showInvoice('${b.id}')"><i class="fas fa-file-pdf"></i></button></td></tr>`).join('')}
                        ${appData.restaurantOrders.filter(o => !o.roomCharge).map((o, idx) => `<tr><td><strong>FAC-REST-${String(idx+1).padStart(3,'0')}</strong></td><td>${o.guest || 'Client restaurant'}</td><td>${formatDate(o.date)}</td><td>${(o.total / 1000).toFixed(0)}k XOF</td><td><span class="badge-modern badge-success">Pay√©e</span></td><td><button class="btn-icon" onclick="showOrderInvoice('${o.id}')"><i class="fas fa-file-pdf"></i></button></td></tr>`).join('')}
                    </tbody></table>
                </div>
            `;
        }

        function renderReports() {
            return `
                <div class="stats-grid">
                    <div class="stat-card-modern"><div class="stat-value-modern">${(appData.stats.hotelRevenue / 1000000).toFixed(1)}M</div><div class="stat-label-modern">CA H√¥tel</div></div>
                    <div class="stat-card-modern"><div class="stat-value-modern">${(appData.stats.restaurantRevenue / 1000000).toFixed(1)}M</div><div class="stat-label-modern">CA Restaurant</div></div>
                    <div class="stat-card-modern"><div class="stat-value-modern">${(appData.expenses.reduce((sum, e) => sum + e.amount, 0) / 1000000).toFixed(1)}M</div><div class="stat-label-modern">D√©penses</div></div>
                </div>
                <div class="row"><div class="col-md-6"><div class="table-card"><h3>Performance mensuelle</h3><canvas id="monthly-report-chart" style="height: 300px;"></canvas></div></div><div class="col-md-6"><div class="table-card"><h3>R√©partition des revenus</h3><canvas id="report-pie-chart" style="height: 300px;"></canvas></div></div></div>
                <div class="table-card mt-3"><h3>Export de donn√©es</h3><div class="row"><div class="col-md-3"><button class="btn-modern primary w-100 mb-2" onclick="exportData('hotel')"><i class="fas fa-file-excel"></i> Export H√¥tel</button></div><div class="col-md-3"><button class="btn-modern primary w-100 mb-2" onclick="exportData('restaurant')"><i class="fas fa-file-excel"></i> Export Restaurant</button></div><div class="col-md-3"><button class="btn-modern primary w-100 mb-2" onclick="exportData('financial')"><i class="fas fa-file-pdf"></i> Rapport financier</button></div></div></div>
            `;
        }

        function renderExpenses() {
            const totalPaid = appData.expenses.filter(e => e.paid).reduce((sum, e) => sum + e.amount, 0);
            const totalUnpaid = appData.expenses.filter(e => !e.paid).reduce((sum, e) => sum + e.amount, 0);
            
            return `
                <div class="stats-grid">
                    <div class="stat-card-modern"><div class="stat-value-modern">${(totalPaid / 1000).toFixed(0)}k</div><div class="stat-label-modern">D√©penses pay√©es</div></div>
                    <div class="stat-card-modern"><div class="stat-value-modern text-warning">${(totalUnpaid / 1000).toFixed(0)}k</div><div class="stat-label-modern">√Ä payer</div></div>
                </div>
                <div class="table-card">
                    <div class="table-header"><h3><i class="fas fa-coins"></i> Liste des d√©penses</h3><button class="btn-modern primary" onclick="openExpenseModal()"><i class="fas fa-plus"></i> Nouvelle d√©pense</button></div>
                    <table class="table"><thead><tr><th>Date</th><th>Cat√©gorie</th><th>Description</th><th>Montant</th><th>√âch√©ance</th><th>Statut</th><th>Actions</th></tr></thead><tbody>${appData.expenses.map(e => `<tr><td>${formatDate(e.date)}</td><td>${e.category}</td><td>${e.description}</td><td><strong>${(e.amount / 1000).toFixed(0)}k XOF</strong></td><td>${formatDate(e.dueDate)}</td><td><span class="badge-modern ${e.paid ? 'badge-success' : 'badge-warning'}">${e.paid ? 'Pay√©e' : 'En attente'}</span></td><td><button class="btn-icon" onclick="editExpense('${e.id}')"><i class="fas fa-edit"></i></button>${!e.paid ? `<button class="btn-icon success" onclick="markAsPaid('${e.id}')"><i class="fas fa-check"></i></button>` : ''}</td></tr>`).join('')}</tbody></table>
                </div>
            `;
        }

        // ========== FONCTIONS M√âTIER ==========
        function submitReservation() {
            const guestName = document.getElementById('guestName').value;
            const guestPhone = document.getElementById('guestPhone').value;
            const guestEmail = document.getElementById('guestEmail').value;
            const roomNumber = parseInt(document.getElementById('roomSelect').value);
            const checkin = document.getElementById('checkinDate').value;
            const checkout = document.getElementById('checkoutDate').value;
            const adults = parseInt(document.getElementById('adults').value);
            const children = parseInt(document.getElementById('children').value);
            const specialRequests = document.getElementById('specialRequests').value;
            
            const room = appData.rooms.find(r => r.number === roomNumber);
            if (!room) return;
            
            const nights = Math.ceil((new Date(checkout) - new Date(checkin)) / (1000 * 60 * 60 * 24));
            const total = room.price * nights;
            
            const newId = 'BK' + String(appData.bookings.length + 1).padStart(3, '0');
            
            const newBooking = {
                id: newId,
                guest: guestName,
                room: room.type,
                roomNumber: room.number,
                checkin: checkin,
                checkout: checkout,
                adults: adults,
                children: children,
                status: 'confirmed',
                total: total,
                phone: guestPhone,
                email: guestEmail,
                prepaid: Math.round(total * 0.3),
                specialRequests: specialRequests
            };
            
            appData.bookings.push(newBooking);
            room.status = 'reserved';
            room.guest = guestName;
            
            if (!appData.guests.some(g => g.phone === guestPhone)) {
                appData.guests.push({
                    id: 'G' + String(appData.guests.length + 1).padStart(3, '0'),
                    name: guestName,
                    email: guestEmail,
                    phone: guestPhone,
                    stays: 1,
                    preferences: specialRequests,
                    totalSpent: total,
                    lastStay: checkin
                });
            }
            
            bootstrap.Modal.getInstance(document.getElementById('reservationModal')).hide();
            updateBadges();
            updateRoomSelectors();
            loadModule('bookings');
            showNotification(`R√©servation cr√©√©e pour ${guestName}`, 'success');
        }

        function deleteBooking(id) {
            if (!confirm('Supprimer cette r√©servation ?')) return;
            const booking = appData.bookings.find(b => b.id === id);
            if (booking) {
                const room = appData.rooms.find(r => r.number === booking.roomNumber);
                if (room) { room.status = 'available'; room.guest = null; }
            }
            appData.bookings = appData.bookings.filter(b => b.id !== id);
            updateBadges();
            loadModule('bookings');
            showNotification('R√©servation supprim√©e', 'success');
        }

        function addOrderItem() {
            const orderItems = document.getElementById('orderItems');
            const newItem = document.createElement('div');
            newItem.className = 'row mb-2 order-item';
            newItem.innerHTML = `
                <div class="col-md-6">
                    <select class="form-control-modern w-100 item-select">
                        <option value="">S√©lectionner un article</option>
                        <option value="Thieboudienne" data-price="12500">Thieboudienne - 12 500 XOF</option>
                        <option value="Yassa Poulet" data-price="11000">Yassa Poulet - 11 000 XOF</option>
                        <option value="Maf√© d'agneau" data-price="12000">Maf√© d'agneau - 12 000 XOF</option>
                        <option value="Poulet DG" data-price="13800">Poulet DG - 13 800 XOF</option>
                        <option value="Pastels" data-price="8000">Pastels - 8 000 XOF</option>
                        <option value="Filet de Capitaine" data-price="14500">Filet de Capitaine - 14 500 XOF</option>
                        <option value="Jus de bissap" data-price="3500">Jus de bissap - 3 500 XOF</option>
                        <option value="Jus de gingembre" data-price="3500">Jus de gingembre - 3 500 XOF</option>
                        <option value="Jus de bouye" data-price="4000">Jus de bouye - 4 000 XOF</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <input type="number" class="form-control-modern w-100 item-qty" value="1" min="1">
                </div>
                <div class="col-md-2">
                    <span class="item-price-display">12 500</span> XOF
                </div>
                <div class="col-md-1">
                    <button type="button" class="btn-icon danger remove-item" onclick="removeOrderItem(this)">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            orderItems.appendChild(newItem);
            
            const select = newItem.querySelector('.item-select');
            const qty = newItem.querySelector('.item-qty');
            select.addEventListener('change', updatePriceDisplay);
            qty.addEventListener('input', calculateOrderTotal);
        }

        function removeOrderItem(btn) {
            btn.closest('.order-item').remove();
            calculateOrderTotal();
        }

        function updatePriceDisplay(e) {
            const row = e.target.closest('.order-item');
            const select = row.querySelector('.item-select');
            const priceDisplay = row.querySelector('.item-price-display');
            const selectedOption = select.options[select.selectedIndex];
            
            if (selectedOption && selectedOption.dataset.price) {
                priceDisplay.textContent = parseInt(selectedOption.dataset.price).toLocaleString();
            }
            calculateOrderTotal();
        }

        function calculateOrderTotal() {
            let total = 0;
            document.querySelectorAll('.order-item').forEach(item => {
                const select = item.querySelector('.item-select');
                const qty = item.querySelector('.item-qty');
                const selectedOption = select.options[select.selectedIndex];
                if (selectedOption && selectedOption.dataset.price) {
                    total += parseInt(selectedOption.dataset.price) * parseInt(qty.value || 1);
                }
            });
            document.getElementById('orderTotal').textContent = total.toLocaleString();
        }

        function submitOrder() {
            const tableNumber = document.getElementById('tableNumber').value;
            const guestName = document.getElementById('orderGuestName').value;
            const chargeToRoom = document.getElementById('chargeToRoom').checked;
            const roomNumber = chargeToRoom ? parseInt(document.getElementById('chargeRoomSelect').value) : null;
            
            const items = [];
            document.querySelectorAll('.order-item').forEach(item => {
                const select = item.querySelector('.item-select');
                const qty = item.querySelector('.item-qty');
                const selectedOption = select.options[select.selectedIndex];
                if (selectedOption && selectedOption.value) {
                    items.push({ name: selectedOption.value, qty: parseInt(qty.value), price: parseInt(selectedOption.dataset.price) });
                }
            });
            
            if (items.length === 0) { showNotification('Veuillez ajouter au moins un article', 'error'); return; }
            
            const total = items.reduce((sum, item) => sum + (item.price * item.qty), 0);
            
            let roomId = null;
            if (chargeToRoom && roomNumber) {
                const booking = appData.bookings.find(b => b.roomNumber === roomNumber && b.status === 'checked-in');
                if (booking) roomId = booking.id;
            }
            
            const newId = 'R' + String(appData.restaurantOrders.length + 1).padStart(3, '0');
            const now = new Date();
            const time = `${now.getHours().toString().padStart(2,'0')}:${now.getMinutes().toString().padStart(2,'0')}`;
            const date = now.toISOString().split('T')[0];
            
            appData.restaurantOrders.push({
                id: newId,
                table: parseInt(tableNumber),
                guest: guestName || 'Anonyme',
                items: items,
                total: total,
                status: chargeToRoom ? 'paid' : 'preparing',
                roomCharge: chargeToRoom,
                roomNumber: roomNumber,
                roomId: roomId,
                time: time,
                date: date
            });
            
            bootstrap.Modal.getInstance(document.getElementById('orderModal')).hide();
            updateBadges();
            loadModule('orders');
            showNotification(`Commande table ${tableNumber} enregistr√©e`, 'success');
        }

        function deleteOrder(id) {
            if (!confirm('Supprimer cette commande ?')) return;
            appData.restaurantOrders = appData.restaurantOrders.filter(o => o.id !== id);
            updateBadges();
            loadModule('orders');
            showNotification('Commande supprim√©e', 'success');
        }

        function markOrderReady(id) {
            const order = appData.restaurantOrders.find(o => o.id === id);
            if (order) { order.status = 'paid'; loadModule(currentModule); showNotification(`Commande table ${order.table} pr√™te`, 'success'); }
        }

        // ========== FACTURES ==========
        function showInvoice(id) {
            const booking = appData.bookings.find(b => b.id === id);
            if (!booking) return;
            
            const roomOrders = appData.restaurantOrders.filter(o => o.roomId === id);
            const roomOrdersTotal = roomOrders.reduce((sum, o) => sum + o.total, 0);
            const total = booking.total + roomOrdersTotal;
            const paid = booking.prepaid + roomOrdersTotal;
            
            const invoiceHTML = `
                <div class="invoice-preview" id="invoice-preview">
                    <div class="invoice-header">
                        <div><img src="images/logo1.png" alt="Lawmar" class="invoice-logo" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'80\' height=\'80\' viewBox=\'0 0 80 80\'%3E%3Crect width=\'80\' height=\'80\' fill=\'%23025ba5\'/%3E%3Ctext x=\'40\' y=\'53\' font-size=\'40\' text-anchor=\'middle\' fill=\'%23ffffff\' font-family=\'Arial\'%3ELAW%3C/text%3E%3C/svg%3E'"></div>
                        <div><h1 class="invoice-title">FACTURE</h1><p>N¬∞ FAC-${String(invoiceCounter).padStart(4,'0')}</p></div>
                    </div>
                    <div class="invoice-details">
                        <div class="row"><div class="col-6"><h5>√âmetteur</h5><p><strong>Lawmar Les R√©sidences</strong><br>Gandiol, Saint-Louis, S√©n√©gal<br>NINEA: 12345678<br>T√©l: +221 33 123 45 67</p></div><div class="col-6 text-end"><h5>Client</h5><p><strong>${booking.guest}</strong><br>T√©l: ${booking.phone}<br>Email: ${booking.email}</p></div></div>
                        <div class="row mt-3"><div class="col-6"><p><strong>Date de facture:</strong> ${formatDate(new Date().toISOString())}</p><p><strong>P√©riode:</strong> ${formatDate(booking.checkin)} au ${formatDate(booking.checkout)}</p></div><div class="col-6 text-end"><p><strong>Chambre:</strong> ${booking.room}</p><p><strong>Statut:</strong> ${getStatusLabel(booking.status)}</p></div></div>
                    </div>
                    <table class="invoice-table"><thead><tr><th>Description</th><th>Quantit√©</th><th>Prix unitaire</th><th>Total</th></tr></thead><tbody>
                        <tr><td>H√©bergement - ${booking.room}</td><td>${Math.ceil((new Date(booking.checkout) - new Date(booking.checkin)) / (1000*60*60*24))} nuits</td><td>${(booking.total / Math.ceil((new Date(booking.checkout) - new Date(booking.checkin)) / (1000*60*60*24))).toLocaleString()} XOF</td><td>${booking.total.toLocaleString()} XOF</td></tr>
                        ${roomOrders.map(o => `<tr><td colspan="4"><strong>Commande Restaurant - Table ${o.table} (${o.time})</strong></td></tr>${o.items.map(item => `<tr><td style="padding-left: 30px;">${item.name}</td><td>${item.qty}</td><td>${item.price.toLocaleString()} XOF</td><td>${(item.price * item.qty).toLocaleString()} XOF</td></tr>`).join('')}`).join('')}
                    </tbody></table>
                    <div class="row"><div class="col-6"><h5>R√©capitulatif des paiements</h5><p>Acompte vers√©: ${booking.prepaid.toLocaleString()} XOF</p><p>Commandes imput√©es: ${roomOrdersTotal.toLocaleString()} XOF</p><p><strong>Total pay√©: ${paid.toLocaleString()} XOF</strong></p></div><div class="col-6"><div class="invoice-total"><p>Total TTC: ${total.toLocaleString()} XOF</p><p>D√©j√† pay√©: ${paid.toLocaleString()} XOF</p><hr><p><strong>Reste √† payer: ${(total - paid).toLocaleString()} XOF</strong></p></div></div></div>
                    <div class="mt-4 text-center text-muted"><small>Merci de votre s√©jour √† Lawmar Les R√©sidences - √Ä bient√¥t !</small></div>
                </div>
            `;
            
            document.getElementById('invoiceContent').innerHTML = invoiceHTML;
            currentInvoice = booking;
            new bootstrap.Modal(document.getElementById('invoiceModal')).show();
            invoiceCounter++;
        }

        function showOrderInvoice(id) {
            const order = appData.restaurantOrders.find(o => o.id === id);
            if (!order) return;
            
            const invoiceHTML = `
                <div class="invoice-preview" id="invoice-preview">
                    <div class="invoice-header">
                        <div><img src="images/logo1.png" alt="Lawmar" class="invoice-logo" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'80\' height=\'80\' viewBox=\'0 0 80 80\'%3E%3Crect width=\'80\' height=\'80\' fill=\'%23025ba5\'/%3E%3Ctext x=\'40\' y=\'53\' font-size=\'40\' text-anchor=\'middle\' fill=\'%23ffffff\' font-family=\'Arial\'%3ELAW%3C/text%3E%3C/svg%3E'"></div>
                        <div><h1 class="invoice-title">FACTURE RESTAURANT</h1><p>N¬∞ FAC-REST-${String(invoiceCounter).padStart(4,'0')}</p></div>
                    </div>
                    <div class="invoice-details">
                        <div class="row"><div class="col-6"><h5>√âmetteur</h5><p><strong>Lawmar Les R√©sidences - Restaurant</strong><br>Gandiol, Saint-Louis, S√©n√©gal<br>NINEA: 12345678<br>T√©l: +221 33 123 45 67</p></div><div class="col-6 text-end"><h5>Client</h5><p><strong>${order.guest || 'Client restaurant'}</strong><br>Table: ${order.table}</p></div></div>
                        <div class="row mt-3"><div class="col-6"><p><strong>Date de facture:</strong> ${formatDate(new Date().toISOString())}</p><p><strong>Heure:</strong> ${order.time}</p></div><div class="col-6 text-end"><p><strong>Statut:</strong> <span class="badge-modern ${order.status === 'paid' ? 'badge-success' : 'badge-warning'}">${getOrderStatusLabel(order.status)}</span></p>${order.roomCharge ? `<p><strong>Imput√© √† la chambre:</strong> ${order.roomNumber}</p>` : ''}</div></div>
                    </div>
                    <table class="invoice-table"><thead><tr><th>Description</th><th>Quantit√©</th><th>Prix unitaire</th><th>Total</th></tr></thead><tbody>${order.items.map(item => `<tr><td>${item.name}</td><td>${item.qty}</td><td>${item.price.toLocaleString()} XOF</td><td>${(item.price * item.qty).toLocaleString()} XOF</td></tr>`).join('')}</tbody></table>
                    <div class="invoice-total"><p><strong>Total √† payer: ${order.total.toLocaleString()} XOF</strong></p></div>
                    <div class="mt-4 text-center text-muted"><small>Merci de votre visite au restaurant Lawmar !</small></div>
                </div>
            `;
            
            document.getElementById('invoiceContent').innerHTML = invoiceHTML;
            currentInvoice = order;
            new bootstrap.Modal(document.getElementById('invoiceModal')).show();
            invoiceCounter++;
        }

        function downloadInvoicePDF() {
            if (!currentInvoice) { showNotification('Aucune facture √† t√©l√©charger', 'error'); return; }
            
            const invoiceElement = document.getElementById('invoice-preview');
            showNotification('G√©n√©ration du PDF en cours...', 'info');
            
            html2canvas(invoiceElement, { scale: 2, backgroundColor: '#ffffff', logging: false, allowTaint: true, useCORS: true })
                .then(canvas => {
                    const imgData = canvas.toDataURL('image/png');
                    try {
                        const pdf = new jspdf.jsPDF({ orientation: 'portrait', unit: 'mm', format: 'a4' });
                        const imgWidth = 210;
                        const imgHeight = (canvas.height * imgWidth) / canvas.width;
                        pdf.addImage(imgData, 'PNG', 0, 0, imgWidth, imgHeight);
                        const fileName = `facture_${currentInvoice.guest || 'restaurant'}_${new Date().toISOString().split('T')[0]}.pdf`;
                        pdf.save(fileName);
                        showNotification('Facture t√©l√©charg√©e avec succ√®s', 'success');
                    } catch (error) {
                        console.error('Erreur jsPDF:', error);
                        showNotification('Erreur lors de la g√©n√©ration du PDF', 'error');
                    }
                })
                .catch(error => {
                    console.error('Erreur html2canvas:', error);
                    showNotification('Erreur lors de la g√©n√©ration du PDF', 'error');
                });
        }

        function checkIn(id) {
            const booking = appData.bookings.find(b => b.id === id);
            if (booking) {
                booking.status = 'checked-in';
                const room = appData.rooms.find(r => r.number === booking.roomNumber);
                if (room) room.status = 'occupied';
                loadModule(currentModule);
                showNotification(`Check-in effectu√© pour ${booking.guest}`, 'success');
            }
        }

        function checkOut(id) {
            const booking = appData.bookings.find(b => b.id === id);
            if (booking) {
                booking.status = 'checked-out';
                const room = appData.rooms.find(r => r.number === booking.roomNumber);
                if (room) { room.status = 'available'; room.guest = null; }
                loadModule(currentModule);
                showNotification(`Check-out effectu√© pour ${booking.guest}`, 'success');
                showInvoice(id);
            }
        }

        function quickReserve(roomNumber) {
            openReservationModal();
            setTimeout(() => {
                document.getElementById('roomSelect').value = roomNumber;
                calculateEstimatedTotal();
            }, 500);
        }

        function openReservationModal() {
            updateRoomSelectors();
            const today = new Date().toISOString().split('T')[0];
            const tomorrow = new Date(Date.now() + 86400000).toISOString().split('T')[0];
            document.getElementById('checkinDate').value = today;
            document.getElementById('checkoutDate').value = tomorrow;
            document.getElementById('estimatedTotal').textContent = '0';
            new bootstrap.Modal(document.getElementById('reservationModal')).show();
        }

        function openOrderModal() {
            document.getElementById('orderForm').reset();
            document.getElementById('orderItems').innerHTML = `
                <div class="row mb-2 order-item">
                    <div class="col-md-6">
                        <select class="form-control-modern w-100 item-select">
                            <option value="">S√©lectionner un article</option>
                            <option value="Thieboudienne" data-price="12500">Thieboudienne - 12 500 XOF</option>
                            <option value="Yassa Poulet" data-price="11000">Yassa Poulet - 11 000 XOF</option>
                            <option value="Maf√© d'agneau" data-price="12000">Maf√© d'agneau - 12 000 XOF</option>
                            <option value="Poulet DG" data-price="13800">Poulet DG - 13 800 XOF</option>
                            <option value="Pastels" data-price="8000">Pastels - 8 000 XOF</option>
                            <option value="Filet de Capitaine" data-price="14500">Filet de Capitaine - 14 500 XOF</option>
                            <option value="Jus de bissap" data-price="3500">Jus de bissap - 3 500 XOF</option>
                            <option value="Jus de gingembre" data-price="3500">Jus de gingembre - 3 500 XOF</option>
                            <option value="Jus de bouye" data-price="4000">Jus de bouye - 4 000 XOF</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <input type="number" class="form-control-modern w-100 item-qty" value="1" min="1">
                    </div>
                    <div class="col-md-2">
                        <span class="item-price-display">12 500</span> XOF
                    </div>
                    <div class="col-md-1">
                        <button type="button" class="btn-icon danger remove-item" onclick="removeOrderItem(this)">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
            `;
            document.getElementById('roomSelectionDiv').style.display = 'none';
            document.getElementById('orderTotal').textContent = '0';
            updateRoomSelectors();
            new bootstrap.Modal(document.getElementById('orderModal')).show();
        }

        // ========== FONCTIONS UTILITAIRES ==========
        function formatDate(dateStr) {
            if (!dateStr) return '-';
            return new Date(dateStr).toLocaleDateString('fr-FR');
        }

        function calculateTimeSince(timeStr) {
            const [hours, minutes] = timeStr.split(':').map(Number);
            const orderTime = new Date(); orderTime.setHours(hours, minutes, 0);
            const now = new Date();
            const diffMinutes = Math.floor((now - orderTime) / (1000 * 60));
            if (diffMinutes < 60) return `${diffMinutes} min`;
            return `${Math.floor(diffMinutes / 60)}h ${diffMinutes % 60}min`;
        }

        function getStatusLabel(status) {
            const labels = { 'confirmed': 'Confirm√©e', 'checked-in': 'En cours', 'checked-out': 'Termin√©e', 'pending': 'En attente' };
            return labels[status] || status;
        }

        function getStatusClass(status) {
            const classes = { 'confirmed': 'badge-success', 'checked-in': 'badge-info', 'checked-out': 'badge-secondary', 'pending': 'badge-warning' };
            return classes[status] || 'badge-info';
        }

        function getOrderStatusLabel(status) {
            const labels = { 'paid': 'Pay√©e', 'preparing': 'En pr√©paration', 'pending': 'En attente' };
            return labels[status] || status;
        }

        function showNotification(message, type = 'success') {
            const container = document.getElementById('notification-center');
            const notification = document.createElement('div');
            notification.className = 'notification-item';
            notification.style.borderLeftColor = type === 'success' ? '#28a745' : type === 'error' ? '#dc3545' : type === 'info' ? '#17a2b8' : '#ffc107';
            const icon = type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : type === 'info' ? 'fa-info-circle' : 'fa-exclamation-triangle';
            notification.innerHTML = `<div style="display: flex; align-items: center; gap: 10px;"><i class="fas ${icon}" style="color: ${type === 'success' ? '#28a745' : type === 'error' ? '#dc3545' : type === 'info' ? '#17a2b8' : '#ffc107'};"></i><span>${message}</span></div>`;
            container.appendChild(notification);
            setTimeout(() => { notification.remove(); }, 4000);
        }

        function initCharts() {
            Object.values(charts).forEach(chart => { if (chart) chart.destroy(); });
            charts = {};
            if (document.getElementById('occupancy-chart')) {
                charts.occupancy = new Chart(document.getElementById('occupancy-chart'), {
                    type: 'line',
                    data: { labels: ['Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam', 'Dim'], datasets: [{ label: 'Taux d\'occupation %', data: [65, 70, 75, 80, 85, 90, 78], borderColor: '#025ba5', backgroundColor: 'rgba(2, 91, 165, 0.1)', tension: 0.4, fill: true }] },
                    options: { responsive: true, plugins: { legend: { display: false } } }
                });
            }
            if (document.getElementById('revenue-chart')) {
                charts.revenue = new Chart(document.getElementById('revenue-chart'), {
                    type: 'doughnut',
                    data: { labels: ['H√¥tel', 'Restaurant'], datasets: [{ data: [appData.stats.hotelRevenue, appData.stats.restaurantRevenue], backgroundColor: ['#025ba5', '#d4af37'], borderWidth: 0 }] },
                    options: { responsive: true, plugins: { legend: { position: 'bottom' } } }
                });
            }
            if (document.getElementById('restaurant-stats')) {
                charts.restaurant = new Chart(document.getElementById('restaurant-stats'), {
                    type: 'doughnut',
                    data: { labels: ['Pay√©es', 'En pr√©paration', 'En attente'], datasets: [{ data: [appData.restaurantOrders.filter(o => o.status === 'paid').length, appData.restaurantOrders.filter(o => o.status === 'preparing').length, appData.restaurantOrders.filter(o => o.status === 'pending').length], backgroundColor: ['#28a745', '#ffc107', '#025ba5'], borderWidth: 0 }] }
                });
            }
            if (document.getElementById('performance-chart')) {
                charts.performance = new Chart(document.getElementById('performance-chart'), {
                    type: 'bar',
                    data: { labels: ['Sem 1', 'Sem 2', 'Sem 3', 'Sem 4'], datasets: [{ label: 'H√¥tel (k XOF)', data: [850, 920, 1100, 980], backgroundColor: '#025ba5' }, { label: 'Restaurant (k XOF)', data: [320, 380, 410, 390], backgroundColor: '#d4af37' }] }
                });
            }
        }

        function initReportsCharts() {
            if (document.getElementById('monthly-report-chart')) {
                new Chart(document.getElementById('monthly-report-chart'), {
                    type: 'bar',
                    data: { labels: ['Sem 1', 'Sem 2', 'Sem 3', 'Sem 4'], datasets: [{ label: 'H√¥tel (k XOF)', data: [850, 920, 1100, 980], backgroundColor: '#025ba5' }, { label: 'Restaurant (k XOF)', data: [320, 380, 410, 390], backgroundColor: '#d4af37' }] }
                });
            }
            if (document.getElementById('report-pie-chart')) {
                new Chart(document.getElementById('report-pie-chart'), {
                    type: 'pie',
                    data: { labels: ['H√¥tel', 'Restaurant', 'Autres'], datasets: [{ data: [70, 25, 5], backgroundColor: ['#025ba5', '#d4af37', '#6c757d'] }] }
                });
            }
        }

        function initCalendar() {
            const calendarEl = document.getElementById('calendar');
            if (calendarEl) {
                new FullCalendar.Calendar(calendarEl, {
                    initialView: 'dayGridMonth',
                    locale: 'fr',
                    headerToolbar: { left: 'prev,next today', center: 'title', right: 'dayGridMonth,timeGridWeek,timeGridDay' },
                    events: appData.bookings.map(b => ({ title: `${b.guest} - ${b.room}`, start: b.checkin, end: b.checkout, color: '#025ba5' }))
                }).render();
            }
        }

        function initDataTable(tableId) {
            if ($(tableId).length && $.fn.DataTable) {
                if ($(tableId).hasClass('dataTable')) $(tableId).DataTable().destroy();
                $(tableId).DataTable({ language: { url: '//cdn.datatables.net/plug-ins/1.13.4/i18n/fr-FR.json' }, pageLength: 10, responsive: true });
            }
        }

        function loadDashboard() { loadModule('dashboard'); }

        // ========== FONCTIONS D'INTERFACE (notifications) ==========
        function viewBooking(id) { showNotification(`Consultation r√©servation ${id}`, 'info'); }
        function viewOrder(id) { showNotification(`Consultation commande ${id}`, 'info'); }
        function viewRoom(number) { showNotification(`Chambre ${number}`, 'info'); }
        function viewGuest(id) { showNotification(`Consultation client ${id}`, 'info'); }
        function editStock(id) { showNotification(`Modification article ${id}`, 'info'); }
        function editEmployee(id) { showNotification(`Modification employ√© ${id}`, 'info'); }
        function editExpense(id) { showNotification(`Modification d√©pense ${id}`, 'info'); }
        function orderStock(id) { showNotification(`Commande fournisseur pour article ${id}`, 'success'); }
        function markAsPaid(id) { const expense = appData.expenses.find(e => e.id === id); if(expense) { expense.paid = true; loadModule('expenses'); showNotification('D√©pense marqu√©e pay√©e', 'success'); } }
        function generateNewInvoice() { showNotification('Cr√©ation d\'une nouvelle facture', 'info'); }
        function generateGuestInvoice(id) { showNotification(`G√©n√©ration facture client ${id}`, 'info'); }
        function exportData(type) { showNotification(`Export ${type} g√©n√©r√©`, 'success'); }
        function openRoomModal() { showNotification('Ajout de chambre (simul√©)', 'info'); }
        function openGuestModal() { showNotification('Ajout de client (simul√©)', 'info'); }
        function openStockModal() { showNotification('Ajout de stock (simul√©)', 'info'); }
        function openEmployeeModal() { showNotification('Ajout d\'employ√© (simul√©)', 'info'); }
        function openExpenseModal() { showNotification('Ajout de d√©pense (simul√©)', 'info'); }

        // Exposer les fonctions globales
        window.logout = logout;
        window.loadModule = loadModule;
        window.switchRole = switchRole;
        window.openReservationModal = openReservationModal;
        window.openOrderModal = openOrderModal;
        window.openRoomModal = openRoomModal;
        window.openGuestModal = openGuestModal;
        window.openStockModal = openStockModal;
        window.openEmployeeModal = openEmployeeModal;
        window.openExpenseModal = openExpenseModal;
        window.quickReserve = quickReserve;
        window.checkIn = checkIn;
        window.checkOut = checkOut;
        window.showInvoice = showInvoice;
        window.showOrderInvoice = showOrderInvoice;
        window.downloadInvoicePDF = downloadInvoicePDF;
        window.deleteBooking = deleteBooking;
        window.deleteOrder = deleteOrder;
        window.markOrderReady = markOrderReady;
        window.addOrderItem = addOrderItem;
        window.removeOrderItem = removeOrderItem;
        window.viewBooking = viewBooking;
        window.viewOrder = viewOrder;
        window.viewRoom = viewRoom;
        window.viewGuest = viewGuest;
        window.editStock = editStock;
        window.editEmployee = editEmployee;
        window.editExpense = editExpense;
        window.orderStock = orderStock;
        window.markAsPaid = markAsPaid;
        window.generateNewInvoice = generateNewInvoice;
        window.generateGuestInvoice = generateGuestInvoice;
        window.exportData = exportData;
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>